% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage[bf,singlelinecheck=off]{caption}
\usepackage{graphicx}
\usepackage{Alegreya}
\usepackage[scale=.7]{sourcecodepro}
\usepackage{hyperref}

\usepackage{framed,color}
\definecolor{shadecolor}{RGB}{248,248,248}

\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

\renewenvironment{quote}{\begin{VF}}{\end{VF}}
\let\oldhref\href
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\ifxetex
  \usepackage{letltxmacro}
  \setlength{\XeTeXLinkMargin}{1pt}
  \LetLtxMacro\SavedIncludeGraphics\includegraphics
  \def\includegraphics#1#{% #1 catches optional stuff (star/opt. arg.)
    \IncludeGraphicsAux{#1}%
  }%
  \newcommand*{\IncludeGraphicsAux}[2]{%
    \XeTeXLinkBox{%
      \SavedIncludeGraphics#1{#2}%
    }%
  }%
\fi

\makeatletter
\newenvironment{kframe}{%
\medskip{}
\setlength{\fboxsep}{.8em}
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\makeatletter
\@ifundefined{Shaded}{
}{\renewenvironment{Shaded}{\begin{kframe}}{\end{kframe}}}
\makeatother

\newenvironment{rmdblock}[1]
  {
  \begin{itemize}
  \renewcommand{\labelitemi}{
    \raisebox{-.7\height}[0pt][0pt]{
      {\setkeys{Gin}{width=3em,keepaspectratio}\includegraphics{images/#1}}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{kframe}
  \item
  }
  {
  \end{kframe}
  \end{itemize}
  }
\newenvironment{rmdnote}
  {\begin{rmdblock}{note}}
  {\end{rmdblock}}
\newenvironment{rmdcaution}
  {\begin{rmdblock}{caution}}
  {\end{rmdblock}}
\newenvironment{rmdimportant}
  {\begin{rmdblock}{important}}
  {\end{rmdblock}}
\newenvironment{rmdtip}
  {\begin{rmdblock}{tip}}
  {\end{rmdblock}}
\newenvironment{rmdwarning}
  {\begin{rmdblock}{warning}}
  {\end{rmdblock}}

\usepackage{makeidx}
\makeindex

\urlstyle{tt}

\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\frontmatter
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Kungfu Pandas},
  pdfauthor={Lê Huỳnh Đức},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Kungfu Pandas}
\author{Lê Huỳnh Đức}
\date{2024-03-08}

\begin{document}
\maketitle

%\cleardoublepage\newpage\thispagestyle{empty}\null
%\cleardoublepage\newpage\thispagestyle{empty}\null
%\cleardoublepage\newpage
\thispagestyle{empty}
\begin{center}
% \includegraphics{images/dedication.pdf}
\end{center}

\setlength{\abovedisplayskip}{-5pt}
\setlength{\abovedisplayshortskip}{-5pt}

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\chapter*{Lời nói đầu}\label{lux1eddi-nuxf3i-ux111ux1ea7u}


\includegraphics{../images/index/cover.jpg}

\chapter{Giới thiệu Pandas}\label{giux1edbi-thiux1ec7u-pandas}

\chapter{Cấu trúc và kiểu dữ liệu}\label{cux1ea5u-truxfac-vuxe0-kiux1ec3u-dux1eef-liux1ec7u}

Mục tiêu của chương này nhằm giới thiệu về các cấu trúc cơ bản trong Pandas là \texttt{Series} và \texttt{DataFrame}.
Trong chương này, bạn sẽ học cách khởi tạo các cấu trúc này cũng như một số thao tác cơ bản trên \texttt{Series}.
Bạn cũng sẽ được biết về một số kiểu dữ liệu thường gặp trong pandas và cách để giảm thiểu bộ nhớ sử dụng khi khởi tạo dữ liệu.

\section{Series}\label{series}

Trong Pandas, \texttt{Series} là mảng 1 chiều bao gồm một danh sách giá trị, và một mảng chứa index
của các giá trị. Trong dữ liệu dảng bảng, mỗi Series được xem như là một cột của bảng đó.
Cách đơn giản để tạo Series như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series(data, index}\OperatorTok{=}\VariableTok{None}\NormalTok{, name}\OperatorTok{=}\VariableTok{None}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó \texttt{data} có thể có dạng:

\begin{itemize}
\item
  dạng List của Python hoặc dạng \texttt{numpy.array}
\item
  dictionary của Python
\item
  là một hằng số duy nhất
\end{itemize}

\texttt{index} có thể truyền hoặc không, tùy vào dạng của \texttt{data} mà \texttt{index} sẽ được định nghĩa khác nhau.
\texttt{name} là tên của \texttt{Series}, giá trị này cũng không nhất thiết phải truyền vào.

\subsection{Các cách khởi tạo}\label{cuxe1c-cuxe1ch-khux1edfi-tux1ea1o}

\subsubsection*{Khởi tạo Series bằng List hoặc dạng numpy.array}\label{khux1edfi-tux1ea1o-series-bux1eb1ng-list-houx1eb7c-dux1ea1ng-numpy.array}


Khi không truyền giá trị \texttt{index}, \texttt{Series} sẽ mặc định index của nó là 1 mảng số nguyên từ \texttt{0} đến \texttt{len(data)\ -\ 1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.Series(data}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{], index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{], name}\OperatorTok{=}\StringTok{"meow"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a    0}
\NormalTok{b    1}
\NormalTok{c    2}
\NormalTok{Name: meow, dtype: int64}
\end{Highlighting}
\end{Shaded}

\subsubsection*{Khởi tạo Series bằng dictionary}\label{khux1edfi-tux1ea1o-series-bux1eb1ng-dictionary}


\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.Series(\{}\StringTok{"b"}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{"a"}\NormalTok{:}\DecValTok{0}\NormalTok{, }\StringTok{"c"}\NormalTok{: }\DecValTok{2}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b    1}
\NormalTok{a    0}
\NormalTok{c    2}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý}:}
Trong trường hợp bạn truyền biến \texttt{index} vào, \texttt{Series} sẽ đánh index dựa vào thứ tự trong \texttt{index}, và chỉ chứa các giá trị của dict có key nằm trong \texttt{index}.
Với các giá trị trong biến \texttt{index} không có trong keys của dict, \texttt{Series} sẽ tạo ra các giá trị bị thiếu \texttt{NaN}.
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.Series(\{}\StringTok{"a"}\NormalTok{: }\DecValTok{0}\NormalTok{, }\StringTok{"b"}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{"c"}\NormalTok{: }\DecValTok{2}\NormalTok{, }\StringTok{"e"}\NormalTok{: }\DecValTok{4}\NormalTok{\}, index}\OperatorTok{=}\NormalTok{[}\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{, }\StringTok{"a"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b    1.0}
\NormalTok{c    2.0}
\NormalTok{d    NaN}
\NormalTok{a    0.0}
\NormalTok{dtype: float64}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý}:}
\texttt{NaN} là giá trị mặc định cho dữ liệu bị thiếu trong pandas và giá trị này có kiểu
là \texttt{float64} nên kiểu dữ liệu của \texttt{Series} cũng là \texttt{float64} khác với \texttt{int64} ở ví dụ trước đó.
\end{rmdnote}

\subsubsection*{Khởi tạo Series bằng một giá trị duy nhất}\label{khux1edfi-tux1ea1o-series-bux1eb1ng-mux1ed9t-giuxe1-trux1ecb-duy-nhux1ea5t}


\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.Series(data}\OperatorTok{=}\DecValTok{1}\NormalTok{, index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a    1}
\NormalTok{b    1}
\NormalTok{c    1}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\subsection{Một số thao tác cơ bản với Series}\label{mux1ed9t-sux1ed1-thao-tuxe1c-cux1a1-bux1ea3n-vux1edbi-series}

Thao tác trên \texttt{Series} cũng giống với thao tác trên \texttt{numpy.array}. Ngoài ra chúng ta còn có thể
tác với Series dựa vào index

Ví dụ:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series(data}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{], index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{, }\StringTok{"e"}\NormalTok{, }\StringTok{"f"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\subsubsection*{Hiển thị toàn bộ giá trị của Series}\label{hiux1ec3n-thux1ecb-touxe0n-bux1ed9-giuxe1-trux1ecb-cux1ee7a-series}


Để xem toàn bộ các giá trị của một Series, ta có thể gọi thuộc tính \texttt{.values}, kết quả sẽ trả về dạng \texttt{numpy.ndarray}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.values}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{array([0, 1, 2, 3, 4, 5])}
\end{Highlighting}
\end{Shaded}

\subsubsection*{Truy cập một phần tử trong Series theo indice}\label{truy-cux1eadp-mux1ed9t-phux1ea7n-tux1eed-trong-series-theo-indice}


\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{2}
\end{Highlighting}
\end{Shaded}

\subsubsection*{Truy cập một phần tử trong Series theo theo index}\label{truy-cux1eadp-mux1ed9t-phux1ea7n-tux1eed-trong-series-theo-theo-index}


\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s[}\StringTok{"c"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{2 }
\end{Highlighting}
\end{Shaded}

\textbf{Slice indice}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s[}\DecValTok{1}\NormalTok{:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b    1}
\NormalTok{d    2}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\textbf{Slice index}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s[}\StringTok{"b"}\NormalTok{:}\StringTok{"c"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b    1}
\NormalTok{c    2}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\textbf{List indice}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s[[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b    1}
\NormalTok{c    2}
\NormalTok{e    4}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\textbf{List index}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s[[}\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"e"}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b    1}
\NormalTok{c    2}
\NormalTok{e    4}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\textbf{Điều kiện}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s[s }\OperatorTok{\textgreater{}}\NormalTok{ s.mean()]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d    3}
\NormalTok{e    4}
\NormalTok{f    5}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\section{DataFrame}\label{cach-khoi-tao-data-frame}

\texttt{DataFrame} là cấu trúc dữ liệu chính và cũng là đặc trưng của pandas. Cũng giống như SQL Table,
\texttt{DataFrame} là một bảng gồm một hay nhiều cột dữ liệu. Hoặc có thể nói rõ hơn là DataFrame là tập
hợp các Series lại với nhau.

Cách khởi tạo DataFrame như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.DataFrame(data}\OperatorTok{=}\VariableTok{None}\NormalTok{, index}\OperatorTok{=}\VariableTok{None}\NormalTok{, columns}\OperatorTok{=}\VariableTok{None}\NormalTok{, dtype}\OperatorTok{=}\VariableTok{None}\NormalTok{, copy}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Cũng giống như Series, \texttt{data} của DataFrame có nhiều cách khởi tạo khác nhau như:

\begin{itemize}
\tightlist
\item
  \texttt{dict} của Series, \texttt{dict} của \texttt{numpy.array}/\texttt{List}
\item
  Mảng 2 chiều \texttt{numpy.ndarray}, \texttt{List} của \texttt{List}
\item
  \href{https://numpy.org/doc/stable/user/basics.rec.html}{Mảng có cấu trúc}
\item
  Từ 1 \texttt{Series}
\item
  Từ \texttt{DataFrame} khác
\end{itemize}

Tùy vào cấu trúc của \texttt{data} mà chúng ta có thể bỏ qua biến \texttt{index}. Biến \texttt{columns} thể hiện tên
của các \texttt{Series}. \texttt{dtype} sẽ định nghĩa các kiểu dữ liệu của dữ liệu, chúng ta sẽ thảo luận về nó
ở phần kế tiếp của chương này. \texttt{copy} dùng để tạo bản sao từ dữ liệu \texttt{data}, nó chỉ ảnh hưởng khi
\texttt{data} là DataFrame khác hoặc numpy.ndarray, việc copy này sẽ tránh trường hợp 2 biến cùng trỏ về
cùng 1 bộ nhớ.

\subsection{Các cách khởi tạo}\label{cuxe1c-cuxe1ch-khux1edfi-tux1ea1o-1}

\textbf{Khởi tạo DataFrame từ dict của Series}

Khi không truyền biến \texttt{index} vào, thì index của \texttt{DataFrame} sẽ là hợp giữa 2 index của \texttt{Series} và
chúng sẽ được sắp xếp theo thứ tự từ vựng. Nếu ta không truyền \texttt{columns} thì các cột của \texttt{DataFrame} sẽ
được sắp xếp theo thứ tự truyền vào các keys của dict.

Khi truyền biến \texttt{index} vào, tương tự như Series, chỉ những index nằm trong \texttt{index} mới được chọn, còn
những index bị thiếu sẽ được điền giá trị \texttt{NaN}

Khi truyền giá trị \texttt{columns}, DataFrame sẽ chọn những \texttt{Series} thuộc dict có key thuộc \texttt{columns}, giá trị
trong \texttt{columns} không có trong key của dict sẽ được gán \texttt{NaN}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{=}\NormalTok{ \{}
            \StringTok{"one"}\NormalTok{: pd.Series([}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{], index}\OperatorTok{=}\NormalTok{[}\StringTok{"c"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{]),}
            \StringTok{"two"}\NormalTok{: pd.Series([}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{], index}\OperatorTok{=}\NormalTok{[}\StringTok{"c"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"d"}\NormalTok{])}
\NormalTok{        \}}
\NormalTok{pd.DataFrame(d)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   one  two}
\NormalTok{a  3.0    2}
\NormalTok{b  2.0    3}
\NormalTok{c  1.0    1}
\NormalTok{d  NaN    4}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.DataFrame(d, index}\OperatorTok{=}\NormalTok{[}\StringTok{"d"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   one  two}
\NormalTok{d  NaN    4}
\NormalTok{b  2.0    3}
\NormalTok{a  3.0    2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.DataFrame(d, index}\OperatorTok{=}\NormalTok{[}\StringTok{"d"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{], columns}\OperatorTok{=}\NormalTok{[}\StringTok{"two"}\NormalTok{, }\StringTok{"three"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   two  three}
\NormalTok{d    }\DecValTok{4}\NormalTok{    NaN}
\NormalTok{b    }\DecValTok{3}\NormalTok{    NaN}
\NormalTok{a    }\DecValTok{2}\NormalTok{    NaN}
\end{Highlighting}
\end{Shaded}

\textbf{Khởi tạo DataFrame từ dict của numpy.ndarray/List}

Đối với việc khởi tạo này, bắt buộc các mảng phải có cùng độ dài. Khi không truyền \texttt{index} vào thì
index của DataFrame sẽ được tạo từ \texttt{0} đến \texttt{len(n)\ -\ 1} trong đó \texttt{n} là độ dài của mảng. Khi truyền
giá trị \texttt{columns}, DataFrame sẽ chọn những key thuộc dict và cũng thuộc \texttt{columns}, giá trị trong
\texttt{columns} không có trong key của dict sẽ được gán \texttt{NaN}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{=}\NormalTok{ \{}
            \StringTok{"one"}\NormalTok{: [}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{],}
            \StringTok{"two"}\NormalTok{: [}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{],}
            \StringTok{"three"}\NormalTok{: [}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{]}
\NormalTok{        \}}
\NormalTok{pd.DataFrame(data}\OperatorTok{=}\NormalTok{d,}
\NormalTok{                     index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{],}
\NormalTok{                     columns}\OperatorTok{=}\NormalTok{[}\StringTok{"one"}\NormalTok{, }\StringTok{"two"}\NormalTok{, }\StringTok{"four"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   one  two four}
\NormalTok{a    1    1   NaN}
\NormalTok{b    2    2   NaN}
\NormalTok{c    3    3   NaN}
\NormalTok{d    4    4   NaN}
\end{Highlighting}
\end{Shaded}

\textbf{Khởi tạo DataFrame từ Mảng 2 chiều/ 2-d numpy.ndarray}

Khi không truyền \texttt{index} vào thì index của \texttt{DataFrame} sẽ được tạo từ \texttt{0} đến \texttt{len(n)\ -\ 1} trong đó \texttt{n}
là số lượng List con hoặc là số dòng hay \texttt{shape{[}0{]}} của \texttt{numpy.ndarray}. Khi không truyền \texttt{columns}
thì tên columns sẽ được tạo từ \texttt{0} đến \texttt{len(n)\ -\ 1} với \texttt{n} là độ dài lớn nhất của List con hoặc \texttt{shape{[}1{]}}
của \texttt{numpy.ndarray}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.DataFrame(data}\OperatorTok{=}\NormalTok{[[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{], [}\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{]], }
\NormalTok{                     index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{], }
\NormalTok{                     columns}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}one\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}two\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}three\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   one  two  three}
\NormalTok{a    1    2    NaN}
\NormalTok{b    3    4    5.0}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.DataFrame(data}\OperatorTok{=}\NormalTok{np.random.rand(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{), }
\NormalTok{                     index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{], }
\NormalTok{                     columns}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}one\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}two\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}three\textquotesingle{}}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{        one       two     three}
\NormalTok{a  0.662008  0.085735  0.331281}
\NormalTok{b  0.115360  0.358092  0.862477}
\end{Highlighting}
\end{Shaded}

\textbf{Khởi tạo DataFrame từ danh sách các dict}

Ở cách khởi tạo này, bạn hãy tưởng tượng rằng mỗi dict là một dòng của DataFrame với các key là tên
cột và value là giá trị tại cột đó. Việc truyền thêm hoặc không truyền \texttt{index} cũng giống
như các trường hợp khởi tạo trên.

\begin{rmdnote}
\textbf{\emph{Lưu ý:}} Trong trường hợp này, nếu bạn truyền \texttt{columns} vào thì \texttt{columns} bắt buộc phải chứa tất cả
các key của dict
\end{rmdnote}

Trong ví dụ dưới đây, \texttt{columns} phải chứa toàn bộ keys \texttt{{[}"one",\ "two",\ "three"{]}}, nếu thiếu 1 trong 3
sẽ phát sinh lỗi.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{=}\NormalTok{ [\{}\StringTok{"one"}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{"two"}\NormalTok{: }\DecValTok{2}\NormalTok{\}, \{}\StringTok{"one"}\NormalTok{: }\DecValTok{4}\NormalTok{, }\StringTok{"two"}\NormalTok{: }\DecValTok{5}\NormalTok{, }\StringTok{"three"}\NormalTok{: }\DecValTok{6}\NormalTok{\}]}
\NormalTok{pd.DataFrame(d, index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{], columns}\OperatorTok{=}\NormalTok{[}\StringTok{"one"}\NormalTok{, }\StringTok{"two"}\NormalTok{, }\StringTok{"three"}\NormalTok{, }\StringTok{"four"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   one  two  three  four}
\NormalTok{a    1    2    NaN   NaN}
\NormalTok{b    4    5    6.0   NaN}
\end{Highlighting}
\end{Shaded}

\textbf{Khởi tạo DataFrame từ Mảng có cấu trúc}

Mảng có cấu trúc là mảng mà các phần tử của nó là một cấu trúc, bao gồm các thành phần nhỏ hơn, các thành phần này được đặt tên và khai báo kiểu dữ liệu.
Dưới đây là một ví dụ Mảng có cấu trúc trong numpy

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ np.array([(}\StringTok{\textquotesingle{}pikachu\textquotesingle{}}\NormalTok{, }\DecValTok{9}\NormalTok{, }\FloatTok{27.0}\NormalTok{), (}\StringTok{\textquotesingle{}mewtwo\textquotesingle{}}\NormalTok{, }\DecValTok{3}\NormalTok{, }\FloatTok{81.0}\NormalTok{)],}
\NormalTok{                        dtype}\OperatorTok{=}\NormalTok{[(}\StringTok{\textquotesingle{}name\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}U10\textquotesingle{}}\NormalTok{), (}\StringTok{\textquotesingle{}age\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}i4\textquotesingle{}}\NormalTok{), (}\StringTok{\textquotesingle{}weight\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}f4\textquotesingle{}}\NormalTok{)])}
\NormalTok{pd.DataFrame(data)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{       name  age  weight}
\NormalTok{0   pikachu    9    27.0}
\NormalTok{1    mewtwo    3    81.0}
\end{Highlighting}
\end{Shaded}

\textbf{Khởi tạo DataFrame từ namedtuple}

Các trường trong \texttt{nametuple} sẽ được gán thành tên các columns trong \texttt{DataFrame}. Những giá trị của \texttt{namedtuple} sẽ được xem là 1 dòng trong \texttt{DataFrame}.
Số lượng cột của \texttt{DataFrame} sẽ phụ thuộc vào số lượng giá trị của phần từ \texttt{namedtuple} đầu tiên. Nếu các phần tử phía sau có số lượng giá trị ít hơn thì
sẽ được điền \texttt{NaN} và ngược lại sẽ trả ra lỗi nếu số lượng giá trị của \texttt{namedtuple} lớn hơn số lượng giá trị của phần tử \texttt{namedtuple} đầu tiên.

Ví dụ về cách tạo namedtuple

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ collections }\ImportTok{import}\NormalTok{ namedtuple}
\NormalTok{Point2D }\OperatorTok{=}\NormalTok{ namedtuple(}\StringTok{"Point2D"}\NormalTok{, }\StringTok{"x y"}\NormalTok{)}
\NormalTok{Point3D }\OperatorTok{=}\NormalTok{ namedtuple(}\StringTok{"Point3D"}\NormalTok{, }\StringTok{"x y z"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Tạo DataFrame từ namedtuple \texttt{Point2D}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.DataFrame([Point2D(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), Point2D(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), Point2D(}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   x  y}
\NormalTok{0  0  0}
\NormalTok{1  0  1}
\NormalTok{2  0  2}
\end{Highlighting}
\end{Shaded}

Tạo DataFrame từ namedtuple cả \texttt{Point2D} và \texttt{Point3D}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.DataFrame([Point3D(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), Point2D(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), Point3D(}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   x  y    z}
\NormalTok{0  0  0  0.0}
\NormalTok{1  0  1  NaN}
\NormalTok{2  0  2  3.0}
\end{Highlighting}
\end{Shaded}

Như ta thấy, tại phần tử thứ 2 chỉ có 2 giá trị, trong khi phần tử thứ nhất có 3 giá trị, vậy nên phần tử bị thiếu tại cột \texttt{z} sẽ được gán \texttt{NaN}

\textbf{Khởi tạo DataFrame từ Series}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series(data}\OperatorTok{=}\NormalTok{[}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{], index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{], name}\OperatorTok{=}\StringTok{"meow"}\NormalTok{)}
\NormalTok{pd.DataFrame(s)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   meow}
\NormalTok{a     0}
\NormalTok{b     1}
\NormalTok{c     2}
\end{Highlighting}
\end{Shaded}

\texttt{name} của Series sẽ là tên cột của DataFrame và \texttt{index} của Series sẽ là index của DataFrame nếu ta không truyền các biến \texttt{index}, \texttt{columns} khi khởi tạo \texttt{pd.DataFrame}

\subsection{Các hàm khởi tạo thay thế}\label{cuxe1c-huxe0m-khux1edfi-tux1ea1o-thay-thux1ebf}

\textbf{DataFrame.from\_dict}

Cách khởi tạo

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.DataFrame.from\_dict(data, orient}\OperatorTok{=}\StringTok{\textquotesingle{}columns\textquotesingle{}}\NormalTok{, dtype}\OperatorTok{=}\VariableTok{None}\NormalTok{, columns}\OperatorTok{=}\VariableTok{None}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\texttt{data} truyền vào là 1 dict, \texttt{orient} có 2 giá trị có thể đưa vào là \texttt{\{"columns",\ "index"\}}, \texttt{columns} là danh sách tên các cột của DataFrame.

\begin{rmdnote}
\textbf{\emph{Lưu ý:}} Chỉ được truyền \texttt{columns} khi \texttt{orient="index"}. Khi \texttt{orient="columns"} sẽ báo lỗi.
\end{rmdnote}

Ví dụ tạo DataFrame khi \texttt{orient="columns"}. Với cách khởi tạo này tên các cột của DataFrame sẽ là key của dict

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ \{}\StringTok{"col\_1"}\NormalTok{: [}\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{], }\StringTok{"col\_2"}\NormalTok{: [}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{]\}}
\NormalTok{pd.DataFrame.from\_dict(data)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   col\_1 col\_2}
\NormalTok{0      3     a}
\NormalTok{1      2     b}
\NormalTok{2      1     c}
\NormalTok{3      0     d}
\end{Highlighting}
\end{Shaded}

Ví dụ tạo DataFrame khi \texttt{orient="index"}. Với cách khởi tạo này index của DataFrame sẽ là key của dict.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ \{}\StringTok{"col\_1"}\NormalTok{: [}\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{], }\StringTok{"col\_2"}\NormalTok{: [}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{]\}}
\NormalTok{pd.DataFrame.from\_dict(data, orient}\OperatorTok{=}\StringTok{"index"}\NormalTok{, }
\NormalTok{                               columns}\OperatorTok{=}\NormalTok{[}\StringTok{"one"}\NormalTok{, }\StringTok{"two"}\NormalTok{, }\StringTok{"three"}\NormalTok{, }\StringTok{"four"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   col\_1 col\_2}
\NormalTok{0      3     a}
\NormalTok{1      2     b}
\NormalTok{2      1     c}
\NormalTok{3      0     d}
\end{Highlighting}
\end{Shaded}

\textbf{DataFrame.from\_records}

Cách khởi tạo

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.DataFrame.from\_records(data)}
\end{Highlighting}
\end{Shaded}

\texttt{data} truyền vào có thể là một mảng có cấu trúc

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ np.array([(}\StringTok{\textquotesingle{}Rex\textquotesingle{}}\NormalTok{, }\DecValTok{9}\NormalTok{, }\FloatTok{81.0}\NormalTok{), (}\StringTok{\textquotesingle{}Fido\textquotesingle{}}\NormalTok{, }\DecValTok{3}\NormalTok{, }\FloatTok{27.0}\NormalTok{)],}
\NormalTok{                        dtype}\OperatorTok{=}\NormalTok{[(}\StringTok{\textquotesingle{}name\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}U10\textquotesingle{}}\NormalTok{), (}\StringTok{\textquotesingle{}age\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}i4\textquotesingle{}}\NormalTok{), (}\StringTok{\textquotesingle{}weight\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}f4\textquotesingle{}}\NormalTok{)])}
\NormalTok{pd.DataFrame.from\_records(data, index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   name  age  weight}
\NormalTok{a   Rex    9    81.0}
\NormalTok{b  Fido    3    27.0}
\end{Highlighting}
\end{Shaded}

Dữ liệu có thể một danh sách các namedtuple

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ collections }\ImportTok{import}\NormalTok{ namedtuple}
\NormalTok{Point2D }\OperatorTok{=}\NormalTok{ namedtuple(}\StringTok{"Point2D"}\NormalTok{, }\StringTok{"x y"}\NormalTok{)}
\NormalTok{Point3D }\OperatorTok{=}\NormalTok{ namedtuple(}\StringTok{"Point3D"}\NormalTok{, }\StringTok{"x y z"}\NormalTok{)}
\NormalTok{pd.DataFrame.from\_records([Point3D(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{), Point2D(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), Point3D(}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)],}
\NormalTok{                          columns}\OperatorTok{=}\NormalTok{[}\StringTok{"x"}\NormalTok{,}\StringTok{"y"}\NormalTok{,}\StringTok{"z"}\NormalTok{], index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   x  y    z}
\NormalTok{a  0  0  0.0}
\NormalTok{b  0  1  NaN}
\NormalTok{c  0  2  3.0}
\end{Highlighting}
\end{Shaded}

Hoặc 1 danh sách các dict

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OperatorTok{=}\NormalTok{ [\{}\StringTok{"one"}\NormalTok{: }\DecValTok{1}\NormalTok{, }\StringTok{"two"}\NormalTok{: }\DecValTok{2}\NormalTok{\}, \{}\StringTok{"one"}\NormalTok{: }\DecValTok{4}\NormalTok{, }\StringTok{"two"}\NormalTok{: }\DecValTok{5}\NormalTok{, }\StringTok{"three"}\NormalTok{: }\DecValTok{6}\NormalTok{\}]}
\NormalTok{pd.DataFrame.from\_records(d, index}\OperatorTok{=}\NormalTok{[}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{], columns}\OperatorTok{=}\NormalTok{[}\StringTok{"one"}\NormalTok{, }\StringTok{"two"}\NormalTok{, }\StringTok{"three"}\NormalTok{, }\StringTok{"four"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   one  two  three  four}
\NormalTok{a    1    2    NaN   NaN}
\NormalTok{b    4    5    6.0   NaN}
\end{Highlighting}
\end{Shaded}

\section{Data type trong pandas}\label{data-type-trong-pandas}

Để kiểm tra kiểu dữ liệu của \texttt{Series} hay \texttt{DataFrame} bạn có thể gọi thuộc tính \texttt{dtypes} hoặc phương thức \texttt{.info()}.
Các kiểu dữ liệu thường gặp của Pandas được mô tả theo bảng dưới đây:

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.3333}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.2500}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.2083}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedright
Các kiểu dữ liệu
phổ biến
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Numpy/Pandas
object
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
Hiển thị
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
Boolean & np.bool & \emph{bool} \\
Integer & np.int,
np.uint & \emph{int}
\emph{uint} \\
Float & np.float & \emph{float} \\
Object & np.object & \emph{O, object} \\
Datetime & np.datetime64,
pd.Timestamp & \emph{datetime64} \\
Timedelta & np.timedelta64,
pd.Timedelta & \emph{timedelta64} \\
Category & pd.Categorical & \emph{category} \\
Complex & np.complex & \emph{complex} \\
\end{longtable}

Ví dụ:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}
                   \StringTok{\textquotesingle{}col\_1\textquotesingle{}}\NormalTok{: [}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{], }
                   \StringTok{\textquotesingle{}col\_2\textquotesingle{}}\NormalTok{: [}\FloatTok{1.0}\NormalTok{, }\FloatTok{2.0}\NormalTok{, }\FloatTok{3.0}\NormalTok{, }\FloatTok{4.0}\NormalTok{], }
                   \StringTok{\textquotesingle{}col\_3\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}4\textquotesingle{}}\NormalTok{],}
                   \StringTok{\textquotesingle{}col\_4\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\DecValTok{4}\NormalTok{],}
                   \StringTok{\textquotesingle{}col\_5\textquotesingle{}}\NormalTok{: [}\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{],}
                   \StringTok{\textquotesingle{}col\_6\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}2021{-}06{-}01\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2021{-}06{-}02\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2021{-}06{-}03\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2021{-}06{-}04\textquotesingle{}}\NormalTok{]\})}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   col\_1  col\_2 col\_3 col\_4  col\_5       col\_6}
\NormalTok{0      1    1.0     1     1   True  2021{-}06{-}01}
\NormalTok{1      0    2.0     2     2  False  2021{-}06{-}02}
\NormalTok{2      1    3.0     3     3   True  2021{-}06{-}03}
\NormalTok{3      0    4.0     4     4  False  2021{-}06{-}04}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.dtypes}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{col\_1      int64}
\NormalTok{col\_2    float64}
\NormalTok{col\_3     object}
\NormalTok{col\_4     object}
\NormalTok{col\_5       bool}
\NormalTok{col\_6     object}
\NormalTok{dtype: object}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}

\begin{itemize}
\item
  Nếu không khai báo kiểu dữ liệu khi khởi tạo, pandas sẽ mặc định kiểu dữ liệu là \texttt{int64}, \texttt{float64}, \texttt{object} và \texttt{bool}.
  Pandas sẽ không biết kiểu dữ liệu \texttt{timestamp} nếu không khai báo.
\item
  Chỉ có thể khai báo duy nhất 1 kiểu dữ liệu khi \hyperref[cach-khoi-tao-data-frame]{khởi tạo pandas}.
  Ví dụ như tất cả dữ liệu của bạn là \texttt{int} hoặc có thể được ép kiểu về \texttt{int}thì có thể khai báo \texttt{dtype=np.int}
  \end{rmdnote}
\end{itemize}

Ở ví dụ phía dưới \texttt{col\_1}, \texttt{col\_2}, \texttt{col\_3}, \texttt{col\_4}, \texttt{col\_5} có thể ép về kiểu \texttt{int}, còn \texttt{col\_6} thì không thể ép kiểu được.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}
                   \StringTok{\textquotesingle{}col\_1\textquotesingle{}}\NormalTok{: [}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{], }
                   \StringTok{\textquotesingle{}col\_2\textquotesingle{}}\NormalTok{: [}\FloatTok{1.0}\NormalTok{, }\FloatTok{2.0}\NormalTok{, }\FloatTok{3.0}\NormalTok{, }\FloatTok{4.0}\NormalTok{], }
                   \StringTok{\textquotesingle{}col\_3\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}4\textquotesingle{}}\NormalTok{],}
                   \StringTok{\textquotesingle{}col\_4\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}1\textquotesingle{}}\NormalTok{, }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}3\textquotesingle{}}\NormalTok{, }\DecValTok{4}\NormalTok{],}
                   \StringTok{\textquotesingle{}col\_5\textquotesingle{}}\NormalTok{: [}\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{],}
                   \StringTok{\textquotesingle{}col\_6\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}2021{-}06{-}01\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2021{-}06{-}02\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2021{-}06{-}03\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2021{-}06{-}04\textquotesingle{}}\NormalTok{]\},}
\NormalTok{                   dtype}\OperatorTok{=}\NormalTok{np.}\BuiltInTok{int}\NormalTok{)}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   col\_1  col\_2  col\_3  col\_4  col\_5       col\_6}
\NormalTok{0      1      1      1      1      1  2021{-}06{-}01}
\NormalTok{1      0      2      2      2      0  2021{-}06{-}02}
\NormalTok{2      1      3      3      3      1  2021{-}06{-}03}
\NormalTok{3      0      4      4      4      0  2021{-}06{-}04}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.dtypes}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{col\_1     int64}
\NormalTok{col\_2     int64}
\NormalTok{col\_3    object}
\NormalTok{col\_4     int64}
\NormalTok{col\_5     int64}
\NormalTok{col\_6     int64}
\NormalTok{dtype: object}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}
Nếu dữ liệu có khoảng nhỏ thì thay vì khai báo kiểu \texttt{np.int}, ta có thể khai báo kiểu \texttt{integer} với số byte phù hợp để giảm bộ nhớ lưu trữ.
Để xem bộ nhớ sử dụng của DataFrame, ta có thể dùng \texttt{.memory\_usage()}.

Một số kiểu integer trong numpy như \texttt{np.int8}, \texttt{np.int16}, \texttt{np.int32}, \texttt{np.int64}, \texttt{np.uint8}, \texttt{np.uint16}, \texttt{np.uint32}, \texttt{np.uint64}
\end{rmdtip}
Theo ví dụ trên, khi \texttt{dtype=np.int}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ df.memory\_usage()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Index    128}
\NormalTok{col\_1     32}
\NormalTok{col\_2     32}
\NormalTok{col\_3     32}
\NormalTok{col\_4     32}
\NormalTok{col\_5     32}
\NormalTok{col\_6     32}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

và sau khi thay bằng \texttt{dtype=np.int8}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ df.memory\_usage()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Index    128}
\NormalTok{col\_1      4}
\NormalTok{col\_2      4}
\NormalTok{col\_3      4}
\NormalTok{col\_4      4}
\NormalTok{col\_5      4}
\NormalTok{col\_6     32}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

Phương thức ép kiểu này được áp dụng khi bạn khởi tạo DataFrame, ngoài ra còn có hàm ép kiểu khác đối với DataFrame cho trước, nội dung này sẽ được đề cập ở \hyperref[Chuong-3]{Chương 3}.

\chapter{Đọc và lưu file trong Pandas}\label{ux111ux1ecdc-vuxe0-lux1b0u-file-trong-pandas}

Ở Chương 1 chúng ta đã biết cách khởi tạo DataFrame từ các dữ liệu cho trước.
Trong chương này sẽ hướng dẫn cách đọc dữ liệu từ file bằng pandas, một số kiểu file thường thấy cho dữ liệu dạng bảng là \texttt{.csv} và \texttt{.xlsx}.
Bạn cũng có thể đọc dữ liệu bán cấu trúc như \texttt{JSON} bằng cách load file bằng Python sau đó dùng các cách khởi tạo như ở Chương 1 hoặc có thể dùng
hàm phụ trợ của Pandas.

Ở phần thứ hai của chương, bạn sẽ được hướng dẫn một số cách cấu hình cho Pandas như thay đổi số dòng, số cột hiển thị\ldots{}

\section{csv, tsv}\label{csv-tsv}

\subsection{Đọc file csv, tsv}\label{ux111ux1ecdc-file-csv-tsv}

Chúng ta có thể đọc file csv với pandas theo lệnh sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.read\_csv(filepath, sep}\OperatorTok{=}\StringTok{\textquotesingle{},\textquotesingle{}}\NormalTok{, names}\OperatorTok{=}\NormalTok{NoDefault.no\_default, index\_col}\OperatorTok{=}\VariableTok{None}\NormalTok{, usecols}\OperatorTok{=}\VariableTok{None}\NormalTok{, dtype}\OperatorTok{=}\VariableTok{None}\NormalTok{, skiprows}\OperatorTok{=}\VariableTok{None}\NormalTok{, skipfooter}\OperatorTok{=}\DecValTok{0}\NormalTok{, nrows}\OperatorTok{=}\VariableTok{None}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{filepath} là đường dẫn đến file trong máy hoặc đường link URL
\item
  \texttt{sep} dùng để nhận diện cách chia thành cột, nếu không truyền tham số này thì \texttt{pandas} tự hiểu là chia theo \texttt{\textquotesingle{},\textquotesingle{}}, ngoài ra có thể chia theo \texttt{\textquotesingle{};\textquotesingle{}} đối với macOS và \texttt{\textquotesingle{}\textbackslash{}t\textquotesingle{}} với file có định dạng \texttt{.tsv}
\item
  \texttt{names} là tên các cột của bảng. Nếu bảng đã có tên cột thì nên bỏ qua tham số này, \texttt{pandas} sẽ lấy dòng đầu tiên của file làm tên cột.
\item
  \texttt{index\_col} dùng để chỉ định vị trí các cột dùng để làm index cho bảng.
\item
  \texttt{usecols} dùng để chỉ định vị trí hoặc tên các cột cần đọc.
\item
  \texttt{dtype} dùng để định dạng kiểu dữ liệu của các cột.
\item
  \texttt{skiprows} được dùng khi muốn bỏ qua một số dòng đầu của bảng.
\item
  \texttt{skipfooter} tương tự như \texttt{skiprows} nhưng sẽ bỏ qua các dòng cuối cùng của bảng.
\item
  \texttt{nrows} dùng để chỉ định số lượng dòng của bạn mà bạn sẽ đọc bằng \texttt{pandas}
\end{itemize}

\textbf{Ví dụ}

Đọc file dữ liệu sale được cho tại \href{https://raw.githubusercontent.com/lhduc94/kungfupandas/master/data/sales_subset.csv}{đây}. Giả sử ta chỉ lấy các cột \texttt{date}, \texttt{weekly\_sales} và \texttt{is\_holiday} và lấy cột \texttt{date} làm \texttt{index} và chỉ lấy 6 dòng đầu

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}https://raw.githubusercontent.com/lhduc94/kungfupandas/master/data/sales\_subset.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{], usecols}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}date\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}weekly\_sales\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}is\_holiday\textquotesingle{}}\NormalTok{], nrows}\OperatorTok{=}\DecValTok{6}\NormalTok{)}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{            weekly\_sales  is\_holiday}
\NormalTok{date                                }
\NormalTok{2010{-}02{-}05      24924.50       False}
\NormalTok{2010{-}03{-}05      21827.90       False}
\NormalTok{2010{-}04{-}02      57258.43       False}
\NormalTok{2010{-}05{-}07      17413.94       False}
\NormalTok{2010{-}06{-}04      17558.09       False}
\NormalTok{2010{-}07{-}02      16333.14       False}
\end{Highlighting}
\end{Shaded}

\subsection{Xuất file csv, tsv}\label{xuux1ea5t-file-csv-tsv}

Để lưu \texttt{DataFrame} dưới dạng file ta có thể dùng câu lệnh \texttt{.to\_csv()} theo cú pháp sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.to\_csv(filename, sep}\OperatorTok{=}\StringTok{\textquotesingle{},\textquotesingle{}}\NormalTok{, columns}\OperatorTok{=}\VariableTok{None}\NormalTok{, header}\OperatorTok{=}\VariableTok{True}\NormalTok{, index}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{filename} là địa chỉ file mà bạn muốn lưu lại
\item
  \texttt{sep} tương tự như lúc đọc file
\item
  \texttt{columns} là tên các cột bạn muốn lưu xuống, nếu muốn lưu tất cả các cột thì
  bạn có thể bỏ qua tham số này.
\item
  \texttt{header} mặc định là \texttt{True} nếu bạn muốn lưu tên cột
\item
  \texttt{index} mặc định là \texttt{True} nếu bạn muốn lưu index của bảng.
\end{itemize}

Ví dụ

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.to\_csv(}\StringTok{\textquotesingle{}sales.csv\textquotesingle{}}\NormalTok{, columns}\OperatorTok{=}\StringTok{\textquotesingle{}weekly\_sales\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Excel}\label{excel}

\subsection{Đọc file Excel}\label{ux111ux1ecdc-file-excel}

Để đọc file Excel ta dùng cú pháp sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OperatorTok{=}\NormalTok{ pd.ExcelFile(filename)}
\end{Highlighting}
\end{Shaded}

Với \texttt{filename} là đường dẫn đến file

Để xem tên các sheets của \texttt{x} ta có thể dùng \texttt{x.sheet\_names}. Sau đó để đọc từng sheet của \texttt{x} ta có thể dùng \texttt{.parse()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ x.parse(sheet\_name, header}\OperatorTok{=}\DecValTok{0}\NormalTok{, names}\OperatorTok{=}\VariableTok{None}\NormalTok{, index\_col}\OperatorTok{=}\VariableTok{None}\NormalTok{, usecols}\OperatorTok{=}\VariableTok{None}\NormalTok{, skiprows}\OperatorTok{=}\VariableTok{None}\NormalTok{, skipfooter}\OperatorTok{=}\DecValTok{0}\NormalTok{, nrows}\OperatorTok{=}\VariableTok{None}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó \texttt{sheet\_name} là tên sheet cần đọc, các thông số còn lại tương tự như phần đọc file \texttt{csv} và \texttt{tsv}. Một cách khác để đọc file excel là dùng hàm \href{https://pandas.pydata.org/docs/reference/api/pandas.read_excel.html}{pandas.read\_excel} với tham số \texttt{io} là tên file.

\subsection{Xuất file Excel}\label{xuux1ea5t-file-excel}

Giả sử ta có các \texttt{DataFrame} df1, df2, df3 cần được lưu vào 1 file Excel duy nhất

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}

\NormalTok{df1 }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}col\_1\textquotesingle{}}\NormalTok{: [}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{]\})}
\NormalTok{df2 }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}col\_1\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}d\textquotesingle{}}\NormalTok{]\})}
\NormalTok{df3 }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}col\_1\textquotesingle{}}\NormalTok{: [}\VariableTok{True}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{False}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

Để ghi các bảng vào file Excel, bước đầu tiên là khởi tạo biến \texttt{writer} theo cú pháp

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{writer }\OperatorTok{=}\NormalTok{ pd.ExcelWriter(}\StringTok{\textquotesingle{}pandas\_multiple.xlsx\textquotesingle{}}\NormalTok{, mode}\OperatorTok{=}\StringTok{\textquotesingle{}w\textquotesingle{}}\NormalTok{,  if\_sheet\_exists}\OperatorTok{=}\VariableTok{None}\NormalTok{, engine}\OperatorTok{=}\VariableTok{None}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{filename} là tên file excel
\item
  \texttt{mode} là phương thức ghi file với \texttt{w} là viết file mới và \texttt{a} là viết thêm vào file. Mặc định là \texttt{w}
\item
  \texttt{if\_sheet\_exists} là phương thức ghi file nếu file hoặc sheet đã tồn tại, bao gồm các phương thức dưới đây (mặc định là error)

  \begin{itemize}
  \item
    \texttt{error}: hiện ValueError nếu đã tồn tại sheet
  \item
    \texttt{new}: Tạo sheet mới với tên phụ thuộc vào \texttt{engine}
  \item
    \texttt{replace}: Xóa nội dung của sheet trước khi viết.
  \item
    \texttt{overlay}: Viết lên sheet đã tồn tại mà không xóa các sheet cũ
  \end{itemize}
\item
  \texttt{engine}: Một số kiểu hỗ trợ ghi file như \texttt{xlsxwriter}, \texttt{openpyxl}, \texttt{openpyxl}, \texttt{odswriter}
\end{itemize}

\begin{rmdnote}
\textbf{\emph{Lưu ý}:}
\texttt{mode=\textquotesingle{}w\textquotesingle{}} không được sử dụng với engine \texttt{xlsxwriter}, khi khai báo engine này sẽ báo lỗi.

\texttt{if\_sheet\_exists} chỉ sử dụng với \texttt{mode=\textquotesingle{}a\textquotesingle{}}

\texttt{overlay} chỉ hỗ trợ với phiên bản \texttt{1.4.0} trở lên.
\end{rmdnote}

Để ghi từng sheet bạn dùng lệnh \texttt{.to\_excel()}. Sau khi ghi tất cả các sheet bạn kết thúc với \texttt{writer.save()} để lưu file

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{writer }\OperatorTok{=}\NormalTok{ pd.ExcelWriter(}\StringTok{\textquotesingle{}mul\_sheets.xlsx\textquotesingle{}}\NormalTok{, mode}\OperatorTok{=}\StringTok{\textquotesingle{}w\textquotesingle{}}\NormalTok{, engine}\OperatorTok{=}\StringTok{\textquotesingle{}openpyxl\textquotesingle{}}\NormalTok{)}
\NormalTok{df1.to\_excel(writer, sheet\_name}\OperatorTok{=}\StringTok{\textquotesingle{}Sheet1\textquotesingle{}}\NormalTok{)}
\NormalTok{df2.to\_excel(writer, sheet\_name}\OperatorTok{=}\StringTok{\textquotesingle{}Sheet2\textquotesingle{}}\NormalTok{)}
\NormalTok{df3.to\_excel(writer, sheet\_name}\OperatorTok{=}\StringTok{\textquotesingle{}Sheet3\textquotesingle{}}\NormalTok{)}
\NormalTok{writer.save()}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}
Có thể dùng \texttt{with} để mở file để tránh trường hợp quên gọi lệnh \texttt{.save()}, lệnh \texttt{with} sẽ tự động lưu file sau khi kết thúc các lệnh con trong nó
\end{rmdtip}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\NormalTok{df1 }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}col\_1\textquotesingle{}}\NormalTok{: [}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{]\})}
\NormalTok{df2 }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}col\_1\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}b\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}d\textquotesingle{}}\NormalTok{]\})}
\NormalTok{df3 }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}col\_1\textquotesingle{}}\NormalTok{: [}\VariableTok{True}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{False}\NormalTok{]\})}
\NormalTok{sheet\_names }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}Sheet1\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}Sheet2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Sheet3\textquotesingle{}}\NormalTok{]}

\ControlFlowTok{with}\NormalTok{ pd.ExcelWriter(}\StringTok{\textquotesingle{}mul\_sheets.xlsx\textquotesingle{}}\NormalTok{, mode}\OperatorTok{=}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, if\_sheet\_exists}\OperatorTok{=}\StringTok{\textquotesingle{}new\textquotesingle{}}\NormalTok{, engine}\OperatorTok{=}\StringTok{\textquotesingle{}openpyxl\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ writer:}
    \ControlFlowTok{for}\NormalTok{ df, sheet\_name }\KeywordTok{in} \BuiltInTok{zip}\NormalTok{([df1, df2, df3], sheet\_names):}
\NormalTok{        df.to\_excel(writer, sheet\_name)}
\end{Highlighting}
\end{Shaded}

\section{JSON}\label{json}

\subsection{Đọc file JSON}\label{ux111ux1ecdc-file-json}

\texttt{JSON} là 1 dạng dữ liệu khá phổ biến trong thực tế. \texttt{Pandas} hỗ trợ đọc file \texttt{JSON} theo phương thức sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pd.read\_json(path\_or\_buf}\OperatorTok{=}\VariableTok{None}\NormalTok{, orient}\OperatorTok{=}\VariableTok{None}\NormalTok{,...)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{path\_or\_buf}: là đường dẫn đến file json hoặc Object cho trước
\item
  \texttt{orient}: Kiểu cấu trúc của json

  \begin{itemize}
  \tightlist
  \item
    \texttt{split}: Dữ liệu có dạng dictionary theo cấu trúc \texttt{\{index\ -\textgreater{}\ {[}index{]},\ columns\ -\ {[}columns{]},\ data\ -\textgreater{}\ {[}values{]}\}}
  \item
    \texttt{records}: Dữ liệu có dạng danh sách các dictionary theo cấu trúc \texttt{{[}\{column\ -\textgreater{}\ value\},\ ...\ ,\ \{column\ -\textgreater{}\ value\}{]}}
  \item
    \texttt{index}: Dữ liệu dạng dictionary theo cấu trúc \texttt{\{"index"\ -\textgreater{}\ \{"column"\ -\textgreater{}\ "value"\}\}}
  \item
    \texttt{columns}: Dữ liệu dạng dictionary theo cấu trúc \texttt{\{column\ -\textgreater{}\ \{index\ -\textgreater{}\ value\}\}}
  \item
    \texttt{values}: danh sách các giá trị
  \end{itemize}
\item
  Ngoài ra còn các tham số khác nữa như \texttt{chunksize}, \texttt{nrow}, các bạn có thể tham khảo tại \href{https://pandas.pydata.org/docs/reference/api/pandas.read_json.html}{pd.read\_json()}
\end{itemize}

Dưới đây là file \texttt{sample\_pokemon.json} với các cấu trúc như sau

Cấu trúc \texttt{records}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{[}\FunctionTok{\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Bulbasaur"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"0.71 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"6.9 kg"}\FunctionTok{\}}\OtherTok{,}
 \FunctionTok{\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Ivysaur"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"0.99 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"13.0 kg"}\FunctionTok{\}}\OtherTok{,}
 \FunctionTok{\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Venusaur"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"2.01 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"100.0 kg"}\FunctionTok{\}}\OtherTok{,}
 \FunctionTok{\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Charmander"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Fire"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"0.61 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"8.5 kg"}\FunctionTok{\}}\OtherTok{,}
 \FunctionTok{\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Charmeleon"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Fire"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"1.09 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"19.0 kg"}\FunctionTok{\}}\OtherTok{]}
\end{Highlighting}
\end{Shaded}

ta có thể gọi

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.read\_json(}\StringTok{\textquotesingle{}sample\_pokemon.json\textquotesingle{}}\NormalTok{, orient}\OperatorTok{=}\StringTok{\textquotesingle{}records\textquotesingle{}}\NormalTok{)}
\NormalTok{df.head()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{         name             type  height    weight}
\NormalTok{0   Bulbasaur  [Grass, Poison]  0.71 m    6.9 kg}
\NormalTok{1     Ivysaur  [Grass, Poison]  0.99 m   13.0 kg}
\NormalTok{2    Venusaur  [Grass, Poison]  2.01 m  100.0 kg}
\NormalTok{3  Charmander           [Fire]  0.61 m    8.5 kg}
\NormalTok{4  Charmeleon           [Fire]  1.09 m   19.0 kg}
\end{Highlighting}
\end{Shaded}

Tương tự với cấu trúc \texttt{split}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\{}\DataTypeTok{"index"}\FunctionTok{:}   \OtherTok{[}\DecValTok{0}\OtherTok{,}\DecValTok{1}\OtherTok{,}\DecValTok{2}\OtherTok{,}\DecValTok{3}\OtherTok{,}\DecValTok{4}\OtherTok{]}\FunctionTok{,}
 \DataTypeTok{"columns"}\FunctionTok{:} \OtherTok{[}\StringTok{"name"}\OtherTok{,}\StringTok{"type"}\OtherTok{,}\StringTok{"height"}\OtherTok{,}\StringTok{"weight"}\OtherTok{]}\FunctionTok{,}
 \DataTypeTok{"data"}\FunctionTok{:}    \OtherTok{[[}\StringTok{"Bulbasaur"}\OtherTok{,[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{],}\StringTok{"0.71 m"}\OtherTok{,}\StringTok{"6.9 kg"}\OtherTok{],}
             \OtherTok{[}\StringTok{"Ivysaur"}\OtherTok{,[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{],}\StringTok{"0.99 m"}\OtherTok{,}\StringTok{"13.0 kg"}\OtherTok{],}
             \OtherTok{[}\StringTok{"Venusaur"}\OtherTok{,[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{],}\StringTok{"2.01 m"}\OtherTok{,}\StringTok{"100.0 kg"}\OtherTok{],}
             \OtherTok{[}\StringTok{"Charmander"}\OtherTok{,[}\StringTok{"Fire"}\OtherTok{],}\StringTok{"0.61 m"}\OtherTok{,}\StringTok{"8.5 kg"}\OtherTok{],}
             \OtherTok{[}\StringTok{"Charmeleon"}\OtherTok{,[}\StringTok{"Fire"}\OtherTok{],}\StringTok{"1.09 m"}\OtherTok{,}\StringTok{"19.0 kg"}\OtherTok{]]}\FunctionTok{\}}
\end{Highlighting}
\end{Shaded}

ta có thể gọi

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.read\_json(}\StringTok{\textquotesingle{}sample\_pokemon.json\textquotesingle{}}\NormalTok{, orient}\OperatorTok{=}\StringTok{\textquotesingle{}split\textquotesingle{}}\NormalTok{)}
\NormalTok{df.head()}
\end{Highlighting}
\end{Shaded}

Các cấu trúc còn lại

\texttt{index}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\{}\DataTypeTok{"0"}\FunctionTok{:\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Bulbasaur"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"0.71 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"6.9 kg"}\FunctionTok{\},}
\DataTypeTok{"1"}\FunctionTok{:\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Ivysaur"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"0.99 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"13.0 kg"}\FunctionTok{\},}
\DataTypeTok{"2"}\FunctionTok{:\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Venusaur"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"2.01 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"100.0 kg"}\FunctionTok{\},}
\DataTypeTok{"3"}\FunctionTok{:\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Charmander"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Fire"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"0.61 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"8.5 kg"}\FunctionTok{\},}
\DataTypeTok{"4"}\FunctionTok{:\{}\DataTypeTok{"name"}\FunctionTok{:}\StringTok{"Charmeleon"}\FunctionTok{,}\DataTypeTok{"type"}\FunctionTok{:}\OtherTok{[}\StringTok{"Fire"}\OtherTok{]}\FunctionTok{,}\DataTypeTok{"height"}\FunctionTok{:}\StringTok{"1.09 m"}\FunctionTok{,}\DataTypeTok{"weight"}\FunctionTok{:}\StringTok{"19.0 kg"}\FunctionTok{\}\}}
\end{Highlighting}
\end{Shaded}

\texttt{columns}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{\{}\DataTypeTok{"name"}\FunctionTok{:\{}\DataTypeTok{"0"}\FunctionTok{:}\StringTok{"Bulbasaur"}\FunctionTok{,}
         \DataTypeTok{"1"}\FunctionTok{:}\StringTok{"Ivysaur"}\FunctionTok{,}
         \DataTypeTok{"2"}\FunctionTok{:}\StringTok{"Venusaur"}\FunctionTok{,}
         \DataTypeTok{"3"}\FunctionTok{:}\StringTok{"Charmander"}
         \StringTok{"4"}\ErrorTok{:}\StringTok{"Charmeleon"}\FunctionTok{\},}
 \DataTypeTok{"type"}\FunctionTok{:\{}\DataTypeTok{"0"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}
         \DataTypeTok{"1"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}
         \DataTypeTok{"2"}\FunctionTok{:}\OtherTok{[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{]}\FunctionTok{,}
         \DataTypeTok{"3"}\FunctionTok{:}\OtherTok{[}\StringTok{"Fire"}\OtherTok{]}\FunctionTok{,}
         \DataTypeTok{"4"}\FunctionTok{:}\OtherTok{[}\StringTok{"Fire"}\OtherTok{]}\FunctionTok{\},}
 \DataTypeTok{"height"}\FunctionTok{:\{}\DataTypeTok{"0"}\FunctionTok{:}\StringTok{"0.71 m"}\FunctionTok{,}
           \DataTypeTok{"1"}\FunctionTok{:}\StringTok{"0.99 m"}\FunctionTok{,}
           \DataTypeTok{"2"}\FunctionTok{:}\StringTok{"2.01 m"}\FunctionTok{,}
           \DataTypeTok{"3"}\FunctionTok{:}\StringTok{"0.61 m"}\FunctionTok{,}
           \DataTypeTok{"4"}\FunctionTok{:}\StringTok{"1.09 m"}\FunctionTok{\},}
 \DataTypeTok{"weight"}\FunctionTok{:\{}\DataTypeTok{"0"}\FunctionTok{:}\StringTok{"6.9 kg"}\FunctionTok{,}
           \DataTypeTok{"1"}\FunctionTok{:}\StringTok{"13.0 kg"}\FunctionTok{,}
           \DataTypeTok{"2"}\FunctionTok{:}\StringTok{"100.0 kg"}\FunctionTok{,}
           \DataTypeTok{"3"}\FunctionTok{:}\StringTok{"8.5 kg"}\FunctionTok{,}
           \DataTypeTok{"4"}\FunctionTok{:}\StringTok{"19.0 kg"}\FunctionTok{\}\}}
\end{Highlighting}
\end{Shaded}

\texttt{values}

\begin{Shaded}
\begin{Highlighting}[]
\OtherTok{[[}\StringTok{"Bulbasaur"}\OtherTok{,[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{],}\StringTok{"0.71 m"}\OtherTok{,}\StringTok{"6.9 kg"}\OtherTok{],}
 \OtherTok{[}\StringTok{"Ivysaur"}\OtherTok{,[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{],}\StringTok{"0.99 m"}\OtherTok{,}\StringTok{"13.0 kg"}\OtherTok{],}
 \OtherTok{[}\StringTok{"Venusaur"}\OtherTok{,[}\StringTok{"Grass"}\OtherTok{,}\StringTok{"Poison"}\OtherTok{],}\StringTok{"2.01 m"}\OtherTok{,}\StringTok{"100.0 kg"}\OtherTok{],}
 \OtherTok{[}\StringTok{"Charmander"}\OtherTok{,[}\StringTok{"Fire"}\OtherTok{],}\StringTok{"0.61 m"}\OtherTok{,}\StringTok{"8.5 kg"}\OtherTok{],}
 \OtherTok{[}\StringTok{"Charmeleon"}\OtherTok{,[}\StringTok{"Fire"}\OtherTok{],}\StringTok{"1.09 m"}\OtherTok{,}\StringTok{"19.0 kg"}\OtherTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý}:}

\begin{itemize}
\item
  \texttt{pd.read\_json()} mặc định \texttt{orient=\textquotesingle{}records\textquotesingle{}}. Các cấu trúc \texttt{records} và \texttt{index} là các cấu trúc JSON thường gặp.
\item
  \texttt{values} không phải cấu trúc JSON.
\item
  có thể truyền link file thay vì file được lưu ở máy.
\end{itemize}
\end{rmdnote}

\subsection{Xuất file JSON}\label{xuux1ea5t-file-json}

\section{Parquet}\label{parquet}

\subsection{Đọc file Parquet}\label{ux111ux1ecdc-file-parquet}

\subsection{Xuất file Parquet}\label{xuux1ea5t-file-parquet}

\section{Pickle}\label{pickle}

\subsection{Đọc file Pickle}\label{ux111ux1ecdc-file-pickle}

\subsection{Xuất file Pickle}\label{xuux1ea5t-file-pickle}

\chapter{Một số hàm cơ bản}\label{Chuong-3}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}https://raw.githubusercontent.com/lhduc94/kungfupandas/master/data/sales\_subset.csv\textquotesingle{}}\NormalTok{,index\_col}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}Unnamed: 0\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.head()} và \texttt{.tail()}}{.head() và .tail()}}\label{head-vuxe0-.tail}

Phương thức \texttt{.head(n=5)} hiển thị \texttt{n} dòng đầu tiên của \texttt{DataFrame}, ngược lại phương thức \texttt{.tail(n=5)} hiển thị \texttt{n} dòng cuối cùng của \texttt{DataFrame}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.head()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{        store type  department        date  weekly\_sales  is\_holiday  \textbackslash{}}
\NormalTok{0      1    A           1  2010{-}02{-}05      24924.50       False   }
\NormalTok{1      1    A           1  2010{-}03{-}05      21827.90       False   }
\NormalTok{2      1    A           1  2010{-}04{-}02      57258.43       False   }
\NormalTok{3      1    A           1  2010{-}05{-}07      17413.94       False   }
\NormalTok{4      1    A           1  2010{-}06{-}04      17558.09       False }

\NormalTok{   temperature\_c  fuel\_price\_usd\_per\_l  unemployment  }
\NormalTok{0       5.727778              0.679451         8.106  }
\NormalTok{1       8.055556              0.693452         8.106  }
\NormalTok{2      16.816667              0.718284         7.808  }
\NormalTok{3      22.527778              0.748928         7.808  }
\NormalTok{4      27.050000              0.714586         7.808  }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.tail()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{       store type  department        date  weekly\_sales  is\_holiday  \textbackslash{}}
\NormalTok{10769     39    A          99  2011{-}12{-}09        895.00       False   }
\NormalTok{10770     39    A          99  2012{-}02{-}03        350.00       False   }
\NormalTok{10771     39    A          99  2012{-}06{-}08        450.00       False   }
\NormalTok{10772     39    A          99  2012{-}07{-}13          0.06       False   }
\NormalTok{10773     39    A          99  2012{-}10{-}05        915.00       False   }

\NormalTok{       temperature\_c  fuel\_price\_usd\_per\_l  unemployment  }
\NormalTok{10769       9.644444              0.834256         7.716  }
\NormalTok{10770      15.938889              0.887619         7.244  }
\NormalTok{10771      27.288889              0.911922         6.989  }
\NormalTok{10772      25.644444              0.860145         6.623  }
\NormalTok{10773      22.250000              0.955511         6.228 }
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.shape} và \texttt{.size}}{.shape và .size}}\label{shape-vuxe0-.size}

Phương thức \texttt{.shape} cho biết số lượng dòng và cột của bảng

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.shape}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(10774, 9)}
\end{Highlighting}
\end{Shaded}

Trong dó \texttt{10774} là số lượng dòng của bảng và \texttt{9} là số lượng cột của bảng

Phương thức \texttt{.size} cho biết số lượng phần từ của bảng

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.size}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{96966}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.info()}}{.info()}}\label{info}

Phương thức \texttt{.info()} dùng để xem một số thông tin cơ bản như

\begin{itemize}
\tightlist
\item
  Index của bảng
\item
  Tên các cột, số lượng các phần tử Null trong cột và kiểu dữ liệu của chúng
\item
  Số lượng các kiểu dữ liệu
\item
  Dung lượng của bảng
\end{itemize}

Ví dụ

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.info()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\textless{}class \textquotesingle{}pandas.core.frame.DataFrame\textquotesingle{}\textgreater{}}
\NormalTok{Int64Index: 10774 entries, 0 to 10773}
\NormalTok{Data columns (total 9 columns):}
\NormalTok{ \#   Column                Non{-}Null Count  Dtype  }
\NormalTok{{-}{-}{-}  {-}{-}{-}{-}{-}{-}                {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}  {-}{-}{-}{-}{-}  }
\NormalTok{ 0   store                 10774 non{-}null  int64  }
\NormalTok{ 1   type                  10774 non{-}null  object }
\NormalTok{ 2   department            10774 non{-}null  int64  }
\NormalTok{ 3   date                  10774 non{-}null  object }
\NormalTok{ 4   weekly\_sales          10774 non{-}null  float64}
\NormalTok{ 5   is\_holiday            10774 non{-}null  bool   }
\NormalTok{ 6   temperature\_c         10774 non{-}null  float64}
\NormalTok{ 7   fuel\_price\_usd\_per\_l  10774 non{-}null  float64}
\NormalTok{ 8   unemployment          10774 non{-}null  float64}
\NormalTok{dtypes: bool(1), float64(4), int64(2), object(2)}
\NormalTok{memory usage: 768.1+ KB}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}
Phương thức \texttt{.info()} có các tham số để tùy chỉnh các thông tin có thể xem. Bạn có thể giới hạn các thông tin theo các tham số dưới đây
\texttt{info(verbose=None,\ buf=None,\ max\_cols=None,\ memory\_usage=None,\ show\_counts=None,\ null\_counts=None)}
\end{rmdtip}

\section{\texorpdfstring{\texttt{.describe()}}{.describe()}}\label{describe}

Phương thức \texttt{.describe()} đưa ra một số thống kê đơn giản như \texttt{count}, \texttt{mean}, \texttt{std}, \texttt{min}, \texttt{max} và \texttt{percentiles\ =\ {[}0.25,\ 0.5,\ 0.75{]}}. Phương thức này chỉ áp dụng cho các cột ở dạng \texttt{numerical}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.describe()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{              store    department   weekly\_sales  temperature\_c  \textbackslash{}}
\NormalTok{count  10774.000000  10774.000000   10774.000000   10774.000000   }
\NormalTok{mean      15.441897     45.218118   23843.950149      15.731978   }
\NormalTok{std       11.534511     29.867779   30220.387557       9.922446   }
\NormalTok{min        1.000000      1.000000   {-}1098.000000      {-}8.366667   }
\NormalTok{25\%        4.000000     20.000000    3867.115000       7.583333   }
\NormalTok{50\%       13.000000     40.000000   12049.065000      16.966667   }
\NormalTok{75\%       20.000000     72.000000   32349.850000      24.166667   }
\NormalTok{max       39.000000     99.000000  293966.050000      33.827778   }

\NormalTok{       fuel\_price\_usd\_per\_l  unemployment  }
\NormalTok{count          10774.000000  10774.000000  }
\NormalTok{mean               0.749746      8.082009  }
\NormalTok{std                0.059494      0.624355  }
\NormalTok{min                0.664129      3.879000  }
\NormalTok{25\%                0.708246      7.795000  }
\NormalTok{50\%                0.743381      8.099000  }
\NormalTok{75\%                0.781421      8.360000  }
\NormalTok{max                1.107674      9.765000  }
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}
Bạn có thể thay đổi thông số percentiles bằng cách truyền tham số này vào trong \texttt{.describe()}
\end{rmdtip}

\textbf{Ví dụ}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.describe(percentiles}\OperatorTok{=}\NormalTok{[}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.99}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{              store    department   weekly\_sales  temperature\_c  \textbackslash{}}
\NormalTok{count  10774.000000  10774.000000   10774.000000   10774.000000   }
\NormalTok{mean      15.441897     45.218118   23843.950149      15.731978   }
\NormalTok{std       11.534511     29.867779   30220.387557       9.922446   }
\NormalTok{min        1.000000      1.000000   {-}1098.000000      {-}8.366667   }
\NormalTok{10\%        2.000000      8.000000     607.695000       2.577778   }
\NormalTok{50\%       13.000000     40.000000   12049.065000      16.966667   }
\NormalTok{99\%       39.000000     99.000000  142193.400300      32.388889   }
\NormalTok{max       39.000000     99.000000  293966.050000      33.827778   }

\NormalTok{       fuel\_price\_usd\_per\_l  unemployment  }
\NormalTok{count          10774.000000  10774.000000  }
\NormalTok{mean               0.749746      8.082009  }
\NormalTok{std                0.059494      0.624355  }
\NormalTok{min                0.664129      3.879000  }
\NormalTok{10\%                0.687640      7.127000  }
\NormalTok{50\%                0.743381      8.099000  }
\NormalTok{99\%                0.978565      9.765000  }
\NormalTok{max                1.107674      9.765000   }
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
\texttt{pandas} mặc định tính thêm percentile tại \texttt{0.5} dù không truyền vào
\end{rmdnote}

\section{\texorpdfstring{\texttt{.index}}{.index}}\label{index}

Thuộc tính \texttt{.index} để lấy index của \texttt{DataFrame} hoặc \texttt{Series}.

Ví dụ

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.index}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Int64Index([    0,     1,     2,     3,     4,     5,     6,     7,     8,}
\NormalTok{                9,}
\NormalTok{            ...}
\NormalTok{            10764, 10765, 10766, 10767, 10768, 10769, 10770, 10771, 10772,}
\NormalTok{            10773],}
\NormalTok{           dtype=\textquotesingle{}int64\textquotesingle{}, length=10774)}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.memory\_usage()}}{.memory\_usage()}}\label{memory_usage}

Phương thức \texttt{.memory\_usage(index=True,\ deep=False)} giúp thông kê dung lượng của từng cột. Trong đó \texttt{index} trả về dung lượng của phần đánh index và \texttt{deep} nếu đặt giá trị \texttt{True} sẽ trả về cách tính toán sâu hơn về bộ nhớ cho kiểu \texttt{object}

Ví dụ

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.memory\_usage(index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{store                   86192}
\NormalTok{type                    86192}
\NormalTok{department              86192}
\NormalTok{date                    86192}
\NormalTok{weekly\_sales            86192}
\NormalTok{is\_holiday              10774}
\NormalTok{temperature\_c           86192}
\NormalTok{fuel\_price\_usd\_per\_l    86192}
\NormalTok{unemployment            86192}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.memory\_usage(deep}\OperatorTok{=}\VariableTok{True}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Index                    86192}
\NormalTok{store                    86192}
\NormalTok{type                    624892}
\NormalTok{department               86192}
\NormalTok{date                    721858}
\NormalTok{weekly\_sales             86192}
\NormalTok{is\_holiday               10774}
\NormalTok{temperature\_c            86192}
\NormalTok{fuel\_price\_usd\_per\_l     86192}
\NormalTok{unemployment             86192}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\section{Truy cập Series trong pandas}\label{truy-cux1eadp-series-trong-pandas}

Sử dụng \texttt{{[}\textless{}tên\ cột\textgreater{}{]}} để lấy 1 Series của bảng. Ví dụ để lấy Series của cột \texttt{department} ta làm như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}department\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0         1}
\NormalTok{1         1}
\NormalTok{2         1}
\NormalTok{3         1}
\NormalTok{4         1}
\NormalTok{         ..}
\NormalTok{10769    99}
\NormalTok{10770    99}
\NormalTok{10771    99}
\NormalTok{10772    99}
\NormalTok{10773    99}
\NormalTok{Name: department, Length: 10774, dtype: int64}
\end{Highlighting}
\end{Shaded}

những Series này cũng có thế áp dụng các phương thức tương tự của \texttt{DataFrame} như \texttt{.head()}, \texttt{.tail()}\ldots.

\section{\texorpdfstring{\texttt{.astype()}}{.astype()}}\label{astype}

Với phương thức \texttt{.astype()} ta có thể ép kiểu dữ liệu của cột về dạng khác. Việc ép kiểu này giúp thay đổi kiểu dữ liệu để tiện các thao tác như nối 2 cột có 2 kiểu \texttt{str} và \texttt{int}, ngoài ra việc ép kiểu cũng giúp giảm được dung lượng bộ nhớ dành cho bảng.

Ở ví dụ trên, ta thấy cột \texttt{department} có giá trị max là \texttt{99} nhưng được mặc định là \texttt{int64} khá lãng phí, do đó ép kiểu về \texttt{int8}

\textbf{Trước khi ép kiểu}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}department\textquotesingle{}}\NormalTok{].dtypes}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dtype(\textquotesingle{}int64\textquotesingle{})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}department\textquotesingle{}}\NormalTok{].memory\_usage() }\OperatorTok{{-}}\NormalTok{ df[}\StringTok{\textquotesingle{}department\textquotesingle{}}\NormalTok{].index.memory\_usage()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{86192}
\end{Highlighting}
\end{Shaded}

\textbf{Sau khi ép kiểu}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}department\textquotesingle{}}\NormalTok{].astype(}\StringTok{\textquotesingle{}int8\textquotesingle{}}\NormalTok{).memory\_usage() }\OperatorTok{{-}}\NormalTok{ df[}\StringTok{\textquotesingle{}department\textquotesingle{}}\NormalTok{].index.memory\_usage()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{10774}
\end{Highlighting}
\end{Shaded}

Ta thấy sau khi ép kiểu thì bộ nhớ lưu trữ của cột \texttt{department} giảm đi \texttt{8} lần.

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
\texttt{df{[}\textquotesingle{}department\textquotesingle{}{]}.memory\_usage()} trả về dung lượng lưu trữ của cột \texttt{department} và dung lượng lưu trữ của \texttt{index}
\end{rmdnote}

\section{\texorpdfstring{\texttt{.drop\_duplicates()}}{.drop\_duplicates()}}\label{drop_duplicates}

Phương thức này trả về \texttt{DataFrame} đã được loại bỏ các hàng trùng nhau.
Lệnh thực hiện

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.drop\_duplicates(subset}\OperatorTok{=}\VariableTok{None}\NormalTok{, keep}\OperatorTok{=}\StringTok{\textquotesingle{}first\textquotesingle{}}\NormalTok{, inplace}\OperatorTok{=}\VariableTok{False}\NormalTok{, ignore\_index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{subset}: tên cột hoặc danh sách các cột cần lọc giá trị trùng lặp, nếu không truyền vào sẽ mặc định chọn tất cả các cột
\item
  \texttt{keep}: các kiểu lọc \texttt{duplicate} bao gồm các lựa chọn sau:

  \begin{itemize}
  \tightlist
  \item
    \texttt{\textquotesingle{}first\textquotesingle{}}: loại bỏ các dòng bản sao, chỉ giữ lại dòng đầu tiên
  \item
    \texttt{\textquotesingle{}last\textquotesingle{}}: loại bỏ các dòng bản sao, chỉ giữ lại dòng cuối cùng
  \item
    \texttt{False}: loại tất cả các dòng trùng lặp
  \end{itemize}
\item
  \texttt{inplace}: thao tác trực tiếp trên bảng nếu để giá trị \texttt{True} hoặc tạo 1 bản sao với giá trị \texttt{False}
\item
  \texttt{ignore\_index}: Nếu \texttt{True} trả về index đánh số lại từ \texttt{0} đến \texttt{n-1}
\end{itemize}

\textbf{Ví dụ}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}
    \StringTok{\textquotesingle{}action\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}view\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}view\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}add to cart\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}add to cart\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}add to cart\textquotesingle{}}\NormalTok{,],}
    \StringTok{\textquotesingle{}fruit\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}orange\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}orange\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}orange\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}apple\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}apple\textquotesingle{}}\NormalTok{],}
    \StringTok{\textquotesingle{}times\textquotesingle{}}\NormalTok{:   [ }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{]}
\NormalTok{\})}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{        action  fruit   times}
\NormalTok{0         view  orange      1}
\NormalTok{1         view  orange      1}
\NormalTok{2  add to cart  orange      3}
\NormalTok{3  add to cart   apple      2}
\NormalTok{4  add to cart   apple      4}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.drop\_duplicates()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{        action  fruit   times}
\NormalTok{0         view  orange      1}
\NormalTok{2  add to cart  orange      3}
\NormalTok{3  add to cart   apple      2}
\NormalTok{4  add to cart   apple      4}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.drop\_duplicates(subset}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}action\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{        action  fruit   times}
\NormalTok{0         view  orange      1}
\NormalTok{2  add to cart  orange      3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.drop\_duplicates(subset}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}action\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}fruit\textquotesingle{}}\NormalTok{], keep}\OperatorTok{=}\StringTok{\textquotesingle{}last\textquotesingle{}}\NormalTok{, ignore\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{        action   fruit  times}
\NormalTok{0         view  orange      1}
\NormalTok{1  add to cart  orange      3}
\NormalTok{2  add to cart   apple      4}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.value\_counts()}}{.value\_counts()}}\label{value_counts}

Phương thức này trả số lần xuất hiện của các phần tử trong \texttt{Series}. Kết quả trả về mặc định sẽ sắp xếp theo số lần xuất hiện giảm dần và mặc định bỏ qua các giá trị null

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Series.value\_counts(normalize}\OperatorTok{=}\VariableTok{False}\NormalTok{, sort}\OperatorTok{=}\VariableTok{True}\NormalTok{, ascending}\OperatorTok{=}\VariableTok{False}\NormalTok{, bins}\OperatorTok{=}\VariableTok{None}\NormalTok{, dropna}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{normalize}: \texttt{True} sẽ trả về tỉ lệ xuất hiện của các phần tử
\item
  \texttt{sort}: \texttt{True} sẽ trả về kết quả sắp xếp theo số lần xuất hiện, \texttt{False} sẽ trả về kết quả sắp xếp theo trình tự xuất hiện của phần tử
\item
  \texttt{ascending}: \texttt{True} sẽ trả về kết quả sắp xếp theo số lần xuất hiện tăng dần.
\item
  \texttt{bins}: gom nhóm các phần tử, tương tự \texttt{pd.cut}
\item
  \texttt{dropna}: \texttt{False} sẽ đếm tất cả các phần tử kể cả null
\end{itemize}

\textbf{Ví dụ}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series([}\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{,  np.nan, }\DecValTok{4}\NormalTok{, np.nan])}
\NormalTok{s.value\_counts()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{3.0    2}
\NormalTok{1.0    1}
\NormalTok{2.0    1}
\NormalTok{4.0    1}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.value\_counts(normalize}\OperatorTok{=}\VariableTok{True}\NormalTok{, sort}\OperatorTok{=}\VariableTok{False}\NormalTok{, dropna}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{3.0    0.285714}
\NormalTok{1.0    0.142857}
\NormalTok{2.0    0.142857}
\NormalTok{NaN    0.285714}
\NormalTok{4.0    0.142857}
\NormalTok{dtype: float64}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.value\_counts(bins}\OperatorTok{=}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(0.996, 2.0]    2}
\NormalTok{(2.0, 3.0]      2}
\NormalTok{(3.0, 4.0]      1}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.unique()} và \texttt{.nunique()}}{.unique() và .nunique()}}\label{unique-vuxe0-.nunique}

Phương thức \texttt{.unique()} trả về các giá trị khác nhau của \texttt{Series} và \texttt{.nunique()} trả về số lượng các giá trị khác nhau của \texttt{Series}. Kết quả trả về của \texttt{.unique()} là danh sách các phần tử được sắp xếp theo thứ tự đầu vào của bảng. Để loại bỏ giá trị \texttt{NA} trong lúc đếm có thể gọi \texttt{.nunique(dropna=False)}

Cách sử dụng

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series([}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{ ,}\DecValTok{2}\NormalTok{, np.nan], name}\OperatorTok{=}\StringTok{\textquotesingle{}col\_0\textquotesingle{}}\NormalTok{)}
\NormalTok{s}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0    2.0}
\NormalTok{1    3.0}
\NormalTok{2    1.0}
\NormalTok{3    2.0}
\NormalTok{4    NaN}
\NormalTok{Name: col\_0, dtype: float64}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.unique()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{array([ 2.,  3.,  1., nan])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.nunique(dropna}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{4}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.drop()}}{.drop()}}\label{drop}

Phương thức \texttt{.drop()} dùng để loại bỏ các dòng hoặc cột theo chỉ định.
Cú pháp của \texttt{.drop()} như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.drop(labels}\OperatorTok{=}\VariableTok{None}\NormalTok{, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{, index}\OperatorTok{=}\VariableTok{None}\NormalTok{, columns}\OperatorTok{=}\VariableTok{None}\NormalTok{, level}\OperatorTok{=}\VariableTok{None}\NormalTok{, inplace}\OperatorTok{=}\VariableTok{False}\NormalTok{, errors}\OperatorTok{=}\StringTok{\textquotesingle{}raise\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{labels}: Tên cột hoặc dòng cần loại bỏ.
\item
  \texttt{axis}: Mặc đinh giá trị \texttt{0} loại bỏ theo dòng và \texttt{1} loại bỏ theo cột.
\item
  \texttt{index}: Chỉ định index của dòng cần loại bỏ, tương đương \texttt{labels,\ axis=0}
\item
  \texttt{columns}: Chỉ định cột cần loại bỏ, tương đương \texttt{labels,\ axis=1}
\item
  \texttt{level}: Dành cho MultiIndex, khi đó chỉ định cấp độ index cần loại bỏ
\item
  \texttt{inplace}: Thực hiện trên chính bảng hay tạo ra một bảng sao
\item
  \texttt{errors}: mặc định \texttt{raise} sẽ trả ra lỗi và \texttt{ignore} nếu muốn bỏ qua lỗi.
\end{itemize}

\textbf{Ví dụ}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.DataFrame(np.arange(}\DecValTok{16}\NormalTok{).reshape(}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{),}
\NormalTok{                  columns}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{],}
\NormalTok{                  index}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3A\textquotesingle{}}\NormalTok{])}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{     A   B   C   D}
\NormalTok{A    0   1   2   3}
\NormalTok{1A   4   5   6   7}
\NormalTok{2A   8   9  10  11}
\NormalTok{3A  12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.drop(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    A   B   C   D}
\NormalTok{1A  4   5   6   7}
\NormalTok{2A  8   9   10  11}
\NormalTok{3A  12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.drop(columns}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{     B   D}
\NormalTok{A    1   3}
\NormalTok{1A   5   7}
\NormalTok{2A   9  11}
\NormalTok{3A  13  15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.drop(index}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2A\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{     A   B   C   D}
\NormalTok{1A   4   5   6   7}
\NormalTok{3A  12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
Thực tế hay dùng các params \texttt{columns} và \texttt{index} để chỉ định các dòng hay cột cần được loại bỏ hơn là dùng \texttt{labels} và \texttt{axis}
\end{rmdnote}

\section{\texorpdfstring{\texttt{.rename()}}{.rename()}}\label{rename}

Phương thức \texttt{.rename()} dùng để đổi tên nhãn của cột hoặc dòng. Cú pháp như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.rename(mapper}\OperatorTok{=}\VariableTok{None}\NormalTok{, }\OperatorTok{*}\NormalTok{, index}\OperatorTok{=}\VariableTok{None}\NormalTok{, columns}\OperatorTok{=}\VariableTok{None}\NormalTok{, axis}\OperatorTok{=}\VariableTok{None}\NormalTok{, copy}\OperatorTok{=}\VariableTok{True}\NormalTok{, inplace}\OperatorTok{=}\VariableTok{False}\NormalTok{, level}\OperatorTok{=}\VariableTok{None}\NormalTok{, errors}\OperatorTok{=}\StringTok{\textquotesingle{}ignore\textquotesingle{}}\NormalTok{)[source]}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{mapper}: là một danh sách dạng dictionary chứa key là tên cần đổi và value là tên mới.
\item
  \texttt{axis}: Mặc đinh giá trị \texttt{0} thay đổi theo index và \texttt{1} thay đổi theo cột.
\item
  \texttt{index}: Chỉ định index của dòng cần thay đổi, tương đương \texttt{mapper,\ axis=0}, thay thế bằng \texttt{index=mapper}
\item
  \texttt{columns}: Chỉ định cột cần thay đổi, tương đương \texttt{mapper,\ axis=1}, thay thế bằng \texttt{columns=mapper}
\item
  \texttt{copy}: \texttt{True}, mặc định sao chép dữ liệu
\item
  \texttt{level}: Dành cho MultiIndex, khi đó chỉ định cấp độ index cần đổi tên
\item
  \texttt{inplace}: Thực hiện trên chính bảng hay tạo ra một bảng sao
\item
  \texttt{errors}: mặc định \texttt{raise} sẽ trả ra lỗi và \texttt{ignore} nếu muốn bỏ qua lỗi.
\end{itemize}

\textbf{Ví dụ}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.DataFrame(np.arange(}\DecValTok{16}\NormalTok{).reshape(}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{),}
\NormalTok{                        columns}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{],}
\NormalTok{                        index}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3A\textquotesingle{}}\NormalTok{])}
\NormalTok{df.rename(mapper}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{:}\StringTok{\textquotesingle{}aA\textquotesingle{}}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{     A   B   C   D}
\NormalTok{aA   0   1   2   3}
\NormalTok{1A   4   5   6   7}
\NormalTok{2A   8   9  10  11}
\NormalTok{3A  12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.rename(mapper}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{:}\StringTok{\textquotesingle{}aA\textquotesingle{}}\NormalTok{\}, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    aA   B   C   D}
\NormalTok{A    0   1   2   3}
\NormalTok{1A   4   5   6   7}
\NormalTok{2A   8   9  10  11}
\NormalTok{3A  12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.rename(columns}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{:}\StringTok{\textquotesingle{}aA\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{:}\StringTok{\textquotesingle{}Bb\textquotesingle{}}\NormalTok{\}, index}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}OA\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}3A\textquotesingle{}}\NormalTok{:}\StringTok{\textquotesingle{}3a\textquotesingle{}}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    aA  Bb   C   D}
\NormalTok{OA   0   1   2   3}
\NormalTok{1A   4   5   6   7}
\NormalTok{2A   8   9  10  11}
\NormalTok{3a  12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
Tương tự như \texttt{.drop()} thì \texttt{columns} và \texttt{index} thường được sử dụng hơn là \texttt{mapper} và \texttt{axis}.

Vẫn chưa rõ \texttt{copy} dùng để làm gì.
\end{rmdnote}

\section{\texorpdfstring{\texttt{.set\_index()}}{.set\_index()}}\label{set_index}

Phương thức \texttt{.set\_index()} dùng để chuyển đổi một cột của bảng thành index. Index này có thể thay thể index cũ hoặc thêm vào để thành \texttt{MultiIndex}. Cách sử dụng như sau:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.set\_index(keys, drop}\OperatorTok{=}\VariableTok{True}\NormalTok{, append}\OperatorTok{=}\VariableTok{False}\NormalTok{, inplace}\OperatorTok{=}\VariableTok{False}\NormalTok{, verify\_integrity}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{keys}: Có thể truyền vào một cột duy nhất hoặc danh sách các cột. Ngoài ra còn có thể là 1 danh sách dạng \texttt{pd.Index}, \texttt{Series}, \texttt{np.array}, \texttt{iterator}
\item
  \texttt{drop}: loại bỏ cột trong bảng nếu đã đưa vào index, mặc định là \texttt{True}
\item
  \texttt{append}: mặc định là \texttt{False} ghi đè lên index đã có. Giá trị \texttt{True} sẽ thêm vào index sẵn có.
\item
  \texttt{inplace}: Thực hiện trực tiếp trên bảng hoặc tạo ra một bản sao
\item
  \texttt{verify\_integrity}: Kiểm tra xem cột đánh index có chứa các phần tử trùng lặp hay không.
\end{itemize}

\textbf{Ví dụ}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.DataFrame(np.arange(}\DecValTok{16}\NormalTok{).reshape(}\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{),}
\NormalTok{                  columns}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{],}
\NormalTok{                  index}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}1A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}2A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}3A\textquotesingle{}}\NormalTok{])}
\NormalTok{df.index.name }\OperatorTok{=} \StringTok{\textquotesingle{}index1\textquotesingle{}}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{         A   B   C   D}
\NormalTok{index1                }
\NormalTok{A        0   1   2   3}
\NormalTok{1A       4   5   6   7}
\NormalTok{2A       8   9  10  11}
\NormalTok{3A      12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.set\_index(}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{     B   C   D}
\NormalTok{A             }
\NormalTok{0    1   2   3}
\NormalTok{4    5   6   7}
\NormalTok{8    9  10  11}
\NormalTok{12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.set\_index([}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{], append}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               C   D}
\NormalTok{index1 A  B         }
\NormalTok{A      0  1    2   3}
\NormalTok{1A     4  5    6   7}
\NormalTok{2A     8  9   10  11}
\NormalTok{3A     12 13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.set\_index([pd.Index([}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{], name}\OperatorTok{=}\StringTok{\textquotesingle{}new\_index\textquotesingle{}}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{            A   B   C   D}
\NormalTok{new\_index                }
\NormalTok{1           0   1   2   3}
\NormalTok{2           4   5   6   7}
\NormalTok{3           8   9  10  11}
\NormalTok{4          12  13  14  15}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
\texttt{keys} không áp dụng cho kiểu \texttt{list}, \texttt{tuple} nhưng Iterator của nó thì được.
\end{rmdnote}
\textbf{Ví dụ} khi đưa list vào sẽ báo lỗi

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.set\_index([}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{KeyError                                  Traceback (most recent call last)}
\NormalTok{\textasciitilde{}\textbackslash{}AppData\textbackslash{}Local\textbackslash{}Temp/ipykernel\_1380/3577861036.py in \textless{}module\textgreater{}}
\NormalTok{{-}{-}{-}{-}\textgreater{} 1 df.set\_index([1, 2, 3, 4])}

\NormalTok{D:\textbackslash{}Vendors\textbackslash{}anaconda\textbackslash{}lib\textbackslash{}site{-}packages\textbackslash{}pandas\textbackslash{}util\textbackslash{}\_decorators.py in wrapper(*args, **kwargs)}
\NormalTok{    309                     stacklevel=stacklevel,}
\NormalTok{    310                 )}
\NormalTok{{-}{-}\textgreater{} 311             return func(*args, **kwargs)}
\NormalTok{    312 }
\NormalTok{    313         return wrapper}

\NormalTok{D:\textbackslash{}Vendors\textbackslash{}anaconda\textbackslash{}lib\textbackslash{}site{-}packages\textbackslash{}pandas\textbackslash{}core\textbackslash{}frame.py in set\_index(self, keys, drop, append, inplace, verify\_integrity)}
\NormalTok{   5492 }
\NormalTok{   5493         if missing:}
\NormalTok{{-}\textgreater{} 5494             raise KeyError(f"None of \{missing\} are in the columns")}
\NormalTok{   5495 }
\NormalTok{   5496         if inplace:}

\NormalTok{KeyError: \textquotesingle{}None of [1, 2, 3, 4] are in the columns\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Trong khi đưa vào \texttt{Iterator} thì hoạt động.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.set\_index(}\BuiltInTok{iter}\NormalTok{([}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    A   B   C   D}
\NormalTok{1   0   1   2   3}
\NormalTok{2   4   5   6   7}
\NormalTok{3   8   9  10  11}
\NormalTok{4  12  13  14  15}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.sort\_values}}{.sort\_values}}\label{sort_values}

Phương thức \texttt{.sort\_values} dùng để sắp xếp dữ liệu trong DataFrame hoặc Series

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.sort\_values(by, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{, ascending}\OperatorTok{=}\VariableTok{True}\NormalTok{, inplace}\OperatorTok{=}\VariableTok{False}\NormalTok{, kind}\OperatorTok{=}\StringTok{\textquotesingle{}quicksort\textquotesingle{}}\NormalTok{, na\_position}\OperatorTok{=}\StringTok{\textquotesingle{}last\textquotesingle{}}\NormalTok{, ignore\_index}\OperatorTok{=}\VariableTok{False}\NormalTok{, key}\OperatorTok{=}\VariableTok{None}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{by} : nhãn hoặc danh sách nhãn cần sắp xếp
\item
  \texttt{axis}: chỉ định chiều sắp xếp \{\texttt{0} hoặc \texttt{index}, \texttt{1} hoặc \texttt{columns}\}
\item
  \texttt{ascending}: Sắp xếp tăng dần hoặc giảm dần, có thể là một giá trị hoặc danh sách các giá trị boolean
\item
  \texttt{inplace}: Thực hiện trên chính bảng đó hoặc tạo ra một bản sao
\item
  \texttt{kind}: Thuật toán sắp xếp
\item
  \texttt{na\_postion}: chỉ định các giá trị \texttt{NA} được xếp đầu hoặc cuôi
\item
  \texttt{ignore\_index}: Nếu để giá trị \texttt{True} sẽ thực hiện đánh index lại từ 0
\item
  \texttt{key}: key function
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}
    \StringTok{\textquotesingle{}col1\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, np.nan, }\StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{],}
    \StringTok{\textquotesingle{}col2\textquotesingle{}}\NormalTok{: [}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{],}
    \StringTok{\textquotesingle{}col3\textquotesingle{}}\NormalTok{: [}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{],}
    \StringTok{\textquotesingle{}col4\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}a\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}c\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}D\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}e\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}F\textquotesingle{}}\NormalTok{]}
\NormalTok{\})}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  col1  col2  col3 col4}
\NormalTok{0    A     2     0    a}
\NormalTok{1    A     1     1    B}
\NormalTok{2    B     9     9    c}
\NormalTok{3  NaN     8     4    D}
\NormalTok{4    D     2     2    e}
\NormalTok{5    C     4     3    F}
\end{Highlighting}
\end{Shaded}

Sắp xếp theo \texttt{col1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.sort\_values(by}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}col1\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  col1  col2  col3 col4}
\NormalTok{0    A     2     0    a}
\NormalTok{1    A     1     1    B}
\NormalTok{2    B     9     9    c}
\NormalTok{5    C     4     3    F}
\NormalTok{4    D     2     2    e}
\NormalTok{3  NaN     8     4    D}
\end{Highlighting}
\end{Shaded}

Sắp xếp theo nhiều cột

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.sort\_values(by}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}col1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}col2\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  col1  col2  col3 col4}
\NormalTok{1    A     1     1    B}
\NormalTok{0    A     2     0    a}
\NormalTok{2    B     9     9    c}
\NormalTok{5    C     4     3    F}
\NormalTok{4    D     7     2    e}
\NormalTok{3  NaN     8     4    D}
\end{Highlighting}
\end{Shaded}

Sắp xếp theo tăng giảm

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.sort\_values(by}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}col1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}col2\textquotesingle{}}\NormalTok{], ascending}\OperatorTok{=}\NormalTok{[}\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  col1  col2  col3 col4}
\NormalTok{4    D     2     2    e}
\NormalTok{5    C     4     3    F}
\NormalTok{2    B     9     9    c}
\NormalTok{1    A     1     1    B}
\NormalTok{0    A     2     0    a}
\NormalTok{3  NaN     8     4    D}
\end{Highlighting}
\end{Shaded}

Thay đổi vị trí của \texttt{NaN}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.sort\_values(by}\OperatorTok{=}\StringTok{\textquotesingle{}col1\textquotesingle{}}\NormalTok{, ascending}\OperatorTok{=}\VariableTok{False}\NormalTok{, na\_position}\OperatorTok{=}\StringTok{\textquotesingle{}first\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  col1  col2  col3 col4}
\NormalTok{3  NaN     8     4    D}
\NormalTok{4    D     2     2    e}
\NormalTok{5    C     4     3    F}
\NormalTok{2    B     9     9    c}
\NormalTok{0    A     2     0    a}
\NormalTok{1    A     1     1    B}
\end{Highlighting}
\end{Shaded}

Sắp xếp với key function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.sort\_values(by}\OperatorTok{=}\StringTok{\textquotesingle{}col4\textquotesingle{}}\NormalTok{, key}\OperatorTok{=}\KeywordTok{lambda}\NormalTok{ col: col.}\BuiltInTok{str}\NormalTok{.lower())}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  col1  col2  col3 col4}
\NormalTok{0    A     2     0    a}
\NormalTok{1    A     1     1    B}
\NormalTok{2    B     9     9    c}
\NormalTok{3  NaN     8     4    D}
\NormalTok{4    D     2     2    e}
\NormalTok{5    C     4     3    F}
\end{Highlighting}
\end{Shaded}

\section{\texorpdfstring{\texttt{.sort\_index}}{.sort\_index}}\label{sort_index}

\chapter{Giới thiệu chương}\label{giux1edbi-thiux1ec7u-chux1b0ux1a1ng}

\section{\texorpdfstring{Sử dụng \texttt{{[}{]}}}{Sử dụng {[}{]}}}\label{sux1eed-dux1ee5ng}

Cú pháp \texttt{{[}{]}} là cú pháp đơn giản nhất để lấy bảng con của 1 bảng cho trước.
Với 1 \texttt{df} là 1 \texttt{DataFrame} có index là \texttt{region} và dữ liệu như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                         state  individuals  family\_members  state\_pop}
\NormalTok{region                                                                }
\NormalTok{East South Central     Alabama       }\FloatTok{2570.0}           \FloatTok{864.0}    \DecValTok{4887681}
\NormalTok{Pacific                 Alaska       }\FloatTok{1434.0}           \FloatTok{582.0}     \DecValTok{735139}
\NormalTok{Mountain               Arizona       }\FloatTok{7259.0}          \FloatTok{2606.0}    \DecValTok{7158024}
\NormalTok{West South Central    Arkansas       }\FloatTok{2280.0}           \FloatTok{432.0}    \DecValTok{3009733}
\NormalTok{Pacific             California     }\FloatTok{109008.0}         \FloatTok{20964.0}   \DecValTok{39461588}
\NormalTok{Mountain              Colorado       }\FloatTok{7607.0}          \FloatTok{3250.0}    \DecValTok{5691287}
\end{Highlighting}
\end{Shaded}

Để chọn 1 bảng con có 2 cột \texttt{{[}\textquotesingle{}state\textquotesingle{},\ \textquotesingle{}family\_members\textquotesingle{}{]}} ta làm như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[[}\StringTok{\textquotesingle{}state\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                         state  family\_members}
\NormalTok{region                                        }
\NormalTok{East South Central     Alabama           864.0}
\NormalTok{Pacific                 Alaska           582.0}
\NormalTok{Mountain               Arizona          2606.0}
\NormalTok{West South Central    Arkansas           432.0}
\NormalTok{Pacific             California         20964.0}
\NormalTok{Mountain              Colorado          3250.0}
\end{Highlighting}
\end{Shaded}

Để lấy theo dòng ta dùng tương tự \texttt{Series}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[:}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                      state  individuals  family\_members  state\_pop}
\NormalTok{region                                                             }
\NormalTok{East South Central  Alabama       2570.0           864.0    4887681}
\NormalTok{Pacific              Alaska       1434.0           582.0     735139}
\NormalTok{Mountain            Arizona       7259.0          2606.0    7158024}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\DecValTok{2}\NormalTok{:}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                         state  individuals  family\_members  state\_pop}
\NormalTok{region                                                                }
\NormalTok{Mountain               Arizona       7259.0          2606.0    7158024}
\NormalTok{West South Central    Arkansas       2280.0           432.0    3009733}
\NormalTok{Pacific             California     109008.0         20964.0   39461588}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}

\begin{itemize}
\item
  \texttt{df{[}{[}\textquotesingle{}state\textquotesingle{}{]}{]}} sẽ trả về \texttt{DataFrame} trong khi \texttt{df{[}\textquotesingle{}state\textquotesingle{}{]}} trả về \texttt{Series}.
\item
  Đối với lấy theo dòng, \texttt{{[}{]}} không lấy được theo dòng riêng biệt.
\item
  \texttt{{[}{]}} chỉ lấy dữ liệu theo dòng hoặc cột, không thực hiện được cùng lúc cả hai thao tác.
  \end{rmdnote}
  Ví dụ khi gọi \texttt{df{[}3{]}} hay \texttt{df{[}{[}1,\ 2,\ 3{]}{]}} sẽ báo lỗi \texttt{KeyError}
\end{itemize}

\section{Sử dụng .loc}\label{sux1eed-dux1ee5ng-.loc}

Phương thức \texttt{.loc} dùng để lấy dữ liệu theo cột hoặc hàng dựa theo nhãn định sẵn (Tên hàng, tên cột), ngoài ra \texttt{.loc} còn nhận các giá trị boolean.

Đầu vào của \texttt{.loc} có thể gồm:

\begin{itemize}
\item
  Nhãn đơn: là 1 số \texttt{3} hoặc dạng chữ \texttt{a}, lưu ý rằng số này là nhãn của \texttt{index} chứ không phải vị trí của dòng.
\item
  Danh sách các nhãn : \texttt{{[}\textquotesingle{}a\textquotesingle{},\ \textquotesingle{}b\textquotesingle{},\ \textquotesingle{}c\textquotesingle{}{]}}
\item
  Đối tượng dạng slice ví dụ \texttt{\textquotesingle{}a\textquotesingle{}:\textquotesingle{}e\textquotesingle{}}
\item
  Danh sách kiểu \texttt{bool} có độ dài bằng với số lượng dòng
\item
  \texttt{Series} dạng \texttt{bool}
\item
  \texttt{pd.Index}
\end{itemize}

Sử dụng nhãn đơn, kết quả trả về là các dòng có nhãn giống như nhãn trong \texttt{.loc}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[}\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{              state  individuals  family\_members  state\_pop}
\NormalTok{region                                                     }
\NormalTok{Pacific      Alaska       1434.0           582.0     735139}
\NormalTok{Pacific  California     109008.0         20964.0   39461588}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}

Khi kết quả là nhiều dòng thì dữ liệu trả về có kiểu \texttt{DataFrame}, trong khi nếu chỉ có 1 dòng duy nhất thì kết quả trả về sẽ theo kiểu \texttt{Series}
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{type}\NormalTok{(df.loc[}\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\textless{}class \textquotesingle{}pandas.core.frame.DataFrame\textquotesingle{}\textgreater{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{type}\NormalTok{(df.loc[}\StringTok{\textquotesingle{}West South Central\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\textless{}class \textquotesingle{}pandas.core.series.Series\textquotesingle{}\textgreater{}}
\end{Highlighting}
\end{Shaded}

Khi đưa danh sách các nhãn dùng \texttt{.loc{[}{[}{]}{]}} thì nhãn đưa vào là nhãn của \texttt{index}. Nếu đưa tên các cột sẽ bị báo lỗi \texttt{KeyError}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[[}\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members  state\_pop}
\NormalTok{region                                                      }
\NormalTok{Pacific       Alaska       1434.0           582.0     735139}
\NormalTok{Pacific   California     109008.0         20964.0   39461588}
\NormalTok{Mountain     Arizona       7259.0          2606.0    7158024}
\NormalTok{Mountain    Colorado       7607.0          3250.0    5691287}
\end{Highlighting}
\end{Shaded}

Để lấy nhãn đơn theo nhãn của \texttt{index} và tên \texttt{column} ta truyền vào phần nhãn của \texttt{index} trước và nhãn của \texttt{column} sau và phân biệt bởi dấu phẩy

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[}\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}state\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{region}
\NormalTok{Pacific        Alaska}
\NormalTok{Pacific    California}
\NormalTok{Name: state, dtype: object}
\end{Highlighting}
\end{Shaded}

Để lấy nhiều hơn 1 nhãn của \texttt{index} hoặc nhiều hơn 1 nhãn của \texttt{column} ta chỉ cần thay thế nhãn đơn của \texttt{index} thành danh sách hoặc slice, tương tự ta có thế thay thế nhãn đơn thành danh sách hoặc slice của \texttt{column}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[}\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{, [}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{]])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{         individuals  family\_members}
\NormalTok{region                              }
\NormalTok{Pacific       1434.0           582.0}
\NormalTok{Pacific     109008.0         20964.0}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[}\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{:}\StringTok{\textquotesingle{}state\_pop\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{         individuals  family\_members  state\_pop}
\NormalTok{region                                         }
\NormalTok{Pacific       1434.0           582.0     735139}
\NormalTok{Pacific     109008.0         20964.0   39461588}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}

\begin{itemize}
\item
  Dùng slice sẽ lấy theo thứ tự xuất hiện chứ không lấy theo thứ tự sắp xếp từ điển, như ví dụ trên thì mặc dù \texttt{family\_members} \textgreater{} \texttt{individuals} nhưng vẫn xếp sau.
\item
  Slice không áp dụng được cho \texttt{index} có nhãn trùng nhau, nếu dùng sẽ báo lỗi \texttt{KeyError:\ "Cannot\ get\ right\ slice\ bound\ for\ non-unique\ label:}
  \end{rmdnote}
\end{itemize}

Danh sách dạng \texttt{boolean}, chỉ sử dụng cho \texttt{index}, không dùng cho \texttt{column}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[[}\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{False}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                       state  individuals  family\_members  state\_pop}
\NormalTok{region                                                              }
\NormalTok{Pacific               Alaska       1434.0           582.0     735139}
\NormalTok{West South Central  Arkansas       2280.0           432.0    3009733}
\end{Highlighting}
\end{Shaded}

Series boolean

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series([}\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{False}\NormalTok{],}
\NormalTok{              index}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}East South Central\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}West South Central\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{])}
\NormalTok{df.loc[s]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                       state  individuals  family\_members  state\_pop}
\NormalTok{region                                                              }
\NormalTok{Pacific               Alaska       1434.0           582.0     735139}
\NormalTok{West South Central  Arkansas       2280.0           432.0    3009733}
\end{Highlighting}
\end{Shaded}

\texttt{pd.Index}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[pd.Index([}\StringTok{"Pacific"}\NormalTok{, }\StringTok{"East South Central"}\NormalTok{], name}\OperatorTok{=}\StringTok{"meow"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                         state  individuals  family\_members  state\_pop}
\NormalTok{meow                                                                   }
\NormalTok{Pacific                 Alaska       1434.0           582.0     735139}
\NormalTok{Pacific             California     109008.0         20964.0   39461588}
\NormalTok{East South Central     Alabama       2570.0           864.0    4887681}
\end{Highlighting}
\end{Shaded}

\textbf{Select với \texttt{MultiIndex}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                     individuals  family\_members  state\_pop}
\NormalTok{region   state                                             }
\NormalTok{Mountain Arizona          }\FloatTok{7259.0}          \FloatTok{2606.0}    \DecValTok{7158024}
\NormalTok{         Colorado         }\FloatTok{7607.0}          \FloatTok{3250.0}    \DecValTok{5691287}
\NormalTok{         Idaho            }\FloatTok{1297.0}           \FloatTok{715.0}    \DecValTok{1750536}
\NormalTok{Pacific  Alaska           }\FloatTok{1434.0}           \FloatTok{582.0}     \DecValTok{735139}
\NormalTok{         California     }\FloatTok{109008.0}         \FloatTok{20964.0}   \DecValTok{39461588}
\NormalTok{         Hawaii           }\FloatTok{4131.0}          \FloatTok{2399.0}    \DecValTok{1420593}
\end{Highlighting}
\end{Shaded}

Với nhãn đơn

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[}\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{          individuals  family\_members  state\_pop}
\NormalTok{state                                           }
\NormalTok{Arizona        7259.0          2606.0    7158024}
\NormalTok{Colorado       7607.0          3250.0    5691287}
\NormalTok{Idaho          1297.0           715.0    1750536}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
Với \texttt{MultiIndex},các index sẽ xếp theo thứ tự từ level 0 đến n (\texttt{level\ 0} cao hơn \texttt{level\ 1} \ldots), với nhãn đơn là nhãn của 1 \texttt{index} thì chỉ thực hiện được index level đầu tiên, các index level sau sẽ báo lỗi.
Theo như ví dụ trên thì \texttt{region} có level cao hơn `state' nên chỉ gọi được \texttt{.loc{[}\textquotesingle{}Mountain\textquotesingle{}{]}} còn \texttt{.loc{[}\textquotesingle{}Arizona\textquotesingle{}{]}} sẽ báo lỗi
\end{rmdnote}

Để select nhiều index cùng lúc, ta truyền vào \texttt{tuple(label1,\ label2...)} theo thứ tự index có level từ cao đến thấp

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[(}\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Colorado\textquotesingle{}}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{individuals          7607.0}
\NormalTok{family\_members       3250.0}
\NormalTok{state\_pop         5691287.0}
\NormalTok{Name: (Mountain, Colorado), dtype: float64}
\end{Highlighting}
\end{Shaded}

Tương tự ta cùng có select theo các column cho trước

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[(}\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Colorado\textquotesingle{}}\NormalTok{), [}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{individuals       7607.0}
\NormalTok{family\_members    3250.0}
\NormalTok{Name: (Mountain, Colorado), dtype: float64}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}
Có thể select \texttt{index} ở các level sau bằng cách dùng \texttt{slice}
\end{rmdtip}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[(}\BuiltInTok{slice}\NormalTok{(}\VariableTok{None}\NormalTok{), }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{), :]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                  individuals  family\_members  state\_pop}
\NormalTok{region   state                                          }
\NormalTok{Mountain Arizona       7259.0          2606.0    7158024}
\end{Highlighting}
\end{Shaded}

\textbf{Slice cho MultiIndex}

Slice từ 1 tuple nhãn đến một nhãn đơn

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[(}\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Colorado\textquotesingle{}}\NormalTok{):}\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                     individuals  family\_members  state\_pop}
\NormalTok{region   state                                             }
\NormalTok{Mountain Colorado         7607.0          3250.0    5691287}
\NormalTok{         Idaho            1297.0           715.0    1750536}
\NormalTok{Pacific  Alaska           1434.0           582.0     735139}
\NormalTok{         California     109008.0         20964.0   39461588}
\NormalTok{         Hawaii           4131.0          2399.0    1420593}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
Nhãn đơn phía sau phải có cùng level với nhãn đầu tiên trong tuple. Trong ví dụ trên nếu thay \texttt{Pacific} thành \texttt{Hawaii} sẽ trả về rỗng. Nhưng khi truyền nhãn không nằm trong các nhãn của index thì vẫn có kết quả trả về
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[(}\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Colorado\textquotesingle{}}\NormalTok{): }\StringTok{\textquotesingle{}meow\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                     individuals  family\_members  state\_pop}
\NormalTok{region   state                                             }
\NormalTok{Mountain Colorado         7607.0          3250.0    5691287}
\NormalTok{         Idaho            1297.0           715.0    1750536}
\NormalTok{Pacific  Alaska           1434.0           582.0     735139}
\NormalTok{         California     109008.0         20964.0   39461588}
\NormalTok{         Hawaii           4131.0          2399.0    1420593}
\end{Highlighting}
\end{Shaded}

Slice từ 1 tuple nhãn đến một tuple nhãn

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[(}\StringTok{\textquotesingle{}Mountain\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Colorado\textquotesingle{}}\NormalTok{):(}\StringTok{\textquotesingle{}Pacific\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}California\textquotesingle{}}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                     individuals  family\_members  state\_pop}
\NormalTok{region   state                                             }
\NormalTok{Mountain Colorado         7607.0          3250.0    5691287}
\NormalTok{         Idaho            1297.0           715.0    1750536}
\NormalTok{Pacific  Alaska           1434.0           582.0     735139}
\NormalTok{         California     109008.0         20964.0   39461588}
\end{Highlighting}
\end{Shaded}

\section{Sử dụng .iloc}\label{sux1eed-dux1ee5ng-.iloc}

Phương thức \texttt{.iloc} dùng để lấy dữ liệu theo cột hoặc hàng dựa theo index của nó, ngoài ra \texttt{.iloc} còn nhận các giá trị boolean.

Đầu vào của \texttt{.iloc} có thể gồm:

\begin{itemize}
\item
  Nhãn đơn: là 1 số \texttt{3}
\item
  Danh sách các số : \texttt{{[}1,\ 2,\ 3{]}}
\item
  Đối tượng dạng slice ví dụ \texttt{1:5}
\item
  Danh sách kiểu \texttt{bool} có độ dài bằng với số lượng dòng
\end{itemize}

Ví dụ với DataFrame

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                         state  individuals  family\_members  state\_pop}
\NormalTok{region                                                                }
\NormalTok{East South Central     Alabama       }\FloatTok{2570.0}           \FloatTok{864.0}    \DecValTok{4887681}
\NormalTok{Pacific                 Alaska       }\FloatTok{1434.0}           \FloatTok{582.0}     \DecValTok{735139}
\NormalTok{Mountain               Arizona       }\FloatTok{7259.0}          \FloatTok{2606.0}    \DecValTok{7158024}
\NormalTok{West South Central    Arkansas       }\FloatTok{2280.0}           \FloatTok{432.0}    \DecValTok{3009733}
\NormalTok{Pacific             California     }\FloatTok{109008.0}         \FloatTok{20964.0}   \DecValTok{39461588}
\NormalTok{Mountain              Colorado       }\FloatTok{7607.0}          \FloatTok{3250.0}    \DecValTok{5691287}
\end{Highlighting}
\end{Shaded}

Khi truyền 1 giá trị nguyên, \texttt{.iloc} trả về giá trị của dòng tại vị trí truyền vào với kiểu \texttt{Series}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.iloc[}\DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{state             Alabama}
\NormalTok{individuals        2570.0}
\NormalTok{family\_members      864.0}
\NormalTok{state\_pop         4887681}
\NormalTok{Name: East South Central, dtype: object}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
\texttt{Series} trả về không chứa nhãn của index, ở đây là nhãn \texttt{East\ South\ Central} của index \texttt{region}
\end{rmdnote}

Để lấy dữ liệu theo cột, ví dụ muốn lấy cột \texttt{family\_members} thì sẽ truyền index cột là \texttt{2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.iloc[:, }\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{region}
\NormalTok{East South Central      864.0}
\NormalTok{Pacific                 582.0}
\NormalTok{Mountain               2606.0}
\NormalTok{West South Central      432.0}
\NormalTok{Pacific               20964.0}
\NormalTok{Mountain               3250.0}
\NormalTok{Name: family\_members, dtype: float64}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}

\begin{itemize}
\item
  \texttt{.iloc} bắt buộc truyền vào vị trí của cột, không cho phép tên cột.
\item
  Sử dụng \texttt{.columns.get\_loc(\textless{}tên\ cột\textgreater{})} để lấy vị trí của cột
  \end{rmdtip}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.iloc[:, df.columns.get\_loc(}\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{region}
\NormalTok{East South Central      864.0}
\NormalTok{Pacific                 582.0}
\NormalTok{Mountain               2606.0}
\NormalTok{West South Central      432.0}
\NormalTok{Pacific               20964.0}
\NormalTok{Mountain               3250.0}
\NormalTok{Name: family\_members, dtype: float64}
\end{Highlighting}
\end{Shaded}

Select theo danh sách, mặc định đưa vào 1 danh sách \texttt{Pandas} sẽ hiểu là lấy theo các dòng

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.iloc[[}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{ ,}\DecValTok{5}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                   individuals  family\_members  state\_pop}
\NormalTok{region   state                                           }
\NormalTok{Mountain Colorado       7607.0          3250.0    5691287}
\NormalTok{Pacific  Alaska         1434.0           582.0     735139}
\NormalTok{         Hawaii         4131.0          2399.0    1420593}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}
Dòng lệnh trên cũng tương đương với \texttt{df.iloc{[}{[}1,\ 3\ ,5{]},\ :{]}}, trong đó \texttt{:} dùng để lấy toàn bộ
\end{rmdtip}

Tương tự để lấy theo danh sách index các cột

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.iloc[:, [}\DecValTok{0}\NormalTok{, }\DecValTok{2}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                     individuals  state\_pop}
\NormalTok{region   state                             }
\NormalTok{Mountain Arizona          7259.0    7158024}
\NormalTok{         Colorado         7607.0    5691287}
\NormalTok{         Idaho            1297.0    1750536}
\NormalTok{Pacific  Alaska           1434.0     735139}
\NormalTok{         California     109008.0   39461588}
\NormalTok{         Hawaii           4131.0    1420593}
\end{Highlighting}
\end{Shaded}

Slice cả 2 chiều

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.iloc[}\DecValTok{2}\NormalTok{:}\DecValTok{4}\NormalTok{, }\DecValTok{0}\NormalTok{:}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                 individuals  family\_members}
\NormalTok{region   state                              }
\NormalTok{Mountain Idaho        1297.0           715.0}
\NormalTok{Pacific  Alaska       1434.0           582.0}
\end{Highlighting}
\end{Shaded}

Sử dụng danh sách các boolean

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Theo dòng}
\NormalTok{df.iloc[[}\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{], :]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                  individuals  family\_members  state\_pop}
\NormalTok{region   state                                          }
\NormalTok{Mountain Arizona       7259.0          2606.0    7158024}
\NormalTok{         Idaho         1297.0           715.0    1750536}
\NormalTok{Pacific  Hawaii        4131.0          2399.0    1420593}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.iloc[:, [}\VariableTok{False}\NormalTok{, }\VariableTok{True}\NormalTok{,}\VariableTok{False}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{                     family\_members}
\NormalTok{region   state                     }
\NormalTok{Mountain Arizona             2606.0}
\NormalTok{         Colorado            3250.0}
\NormalTok{         Idaho                715.0}
\NormalTok{Pacific  Alaska               582.0}
\NormalTok{         California         20964.0}
\NormalTok{         Hawaii              2399.0}
\end{Highlighting}
\end{Shaded}

\section{Lọc theo điều kiện}\label{lux1ecdc-theo-ux111iux1ec1u-kiux1ec7n}

Các phương thức \texttt{{[}{]}}, \texttt{.loc} hay \texttt{.iloc} ngoài việc lấy dữ liệu theo hàng và cột còn có thể lấy ra những bảng con theo các điều kiện cho trước. Bản chất các câu điều kiện sẽ trả về một danh sách dạng bolean và các hàm trên thực hiện lọc theo danh sách đó.

Trước hết ta cần biết câu điều kiện trong Pandas như thế nào. Ví dụ ta có 1 \texttt{DataFrame} như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members  state\_pop}
\NormalTok{region                                                      }
\NormalTok{Mountain     Arizona       }\FloatTok{7259.0}          \FloatTok{2606.0}    \DecValTok{7158024}
\NormalTok{Mountain    Colorado       }\FloatTok{7607.0}          \FloatTok{3250.0}    \DecValTok{5691287}
\NormalTok{Mountain       Idaho       }\FloatTok{1297.0}           \FloatTok{715.0}    \DecValTok{1750536}
\NormalTok{Pacific       Alaska       }\FloatTok{1434.0}           \FloatTok{582.0}     \DecValTok{735139}
\NormalTok{Pacific   California     }\FloatTok{109008.0}         \FloatTok{20964.0}   \DecValTok{39461588}
\NormalTok{Pacific       Hawaii       }\FloatTok{4131.0}          \FloatTok{2399.0}    \DecValTok{1420593}
\end{Highlighting}
\end{Shaded}

\subsection{Toán tử điều kiện}\label{touxe1n-tux1eed-ux111iux1ec1u-kiux1ec7n}

Giả sử ta có một điều kiện rằng \texttt{df{[}\textquotesingle{}individuals\textquotesingle{}{]}\ \textgreater{}\ 5000}. Kết quả trả về là 1 \texttt{Series}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{5000}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{region}
\NormalTok{Mountain     True}
\NormalTok{Mountain     True}
\NormalTok{Mountain    False}
\NormalTok{Pacific     False}
\NormalTok{Pacific      True}
\NormalTok{Pacific     False}
\NormalTok{Name: individuals, dtype: bool}
\end{Highlighting}
\end{Shaded}

Để lọc theo điều kiện này ta có các cách như sau

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Dùng []}
\NormalTok{df[df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{5000}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members  state\_pop}
\NormalTok{region                                                      }
\NormalTok{Mountain     Arizona       7259.0          2606.0    7158024}
\NormalTok{Mountain    Colorado       7607.0          3250.0    5691287}
\NormalTok{Pacific   California     109008.0         20964.0   39461588}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Dùng .loc}
\NormalTok{df.loc[df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{5000}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members  state\_pop}
\NormalTok{region                                                      }
\NormalTok{Mountain     Arizona       7259.0          2606.0    7158024}
\NormalTok{Mountain    Colorado       7607.0          3250.0    5691287}
\NormalTok{Pacific   California     109008.0         20964.0   39461588}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
\texttt{.iloc} không nhận \texttt{Series} boolean nhưng \texttt{array} thì có thể. Do đó ta có thể dùng \texttt{.values} để lấy kết quả của Câu điều kiện
\end{rmdnote}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Dùng .iloc}
\NormalTok{df.iloc[(df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{5000}\NormalTok{).values]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members  state\_pop}
\NormalTok{region                                                      }
\NormalTok{Mountain     Arizona       7259.0          2606.0    7158024}
\NormalTok{Mountain    Colorado       7607.0          3250.0    5691287}
\NormalTok{Pacific   California     109008.0         20964.0   39461588}
\end{Highlighting}
\end{Shaded}

Ta cũng có thể áp nhiều điều kiện cùng lúc, mỗi điều kiện phải nằm trong dấu ngoặc đơn \texttt{()} và giữa các kiều kiện là toán tử \texttt{\&} hoặc \texttt{\textbar{}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Nhiều câu điều kiện trên một cột}
\NormalTok{df.loc[(df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{5000}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textless{}} \DecValTok{10000}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{             state  individuals  family\_members  state\_pop}
\NormalTok{region                                                    }
\NormalTok{Mountain   Arizona       7259.0          2606.0    7158024}
\NormalTok{Mountain  Colorado       7607.0          3250.0    5691287}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Nhiều câu điều kiện ở nhiều cột}
\NormalTok{df.loc[(df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{5000}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df[}\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{] }\OperatorTok{\textless{}} \DecValTok{10000}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{             state  individuals  family\_members  state\_pop}
\NormalTok{region                                                    }
\NormalTok{Mountain   Arizona       7259.0          2606.0    7158024}
\NormalTok{Mountain  Colorado       7607.0          3250.0    5691287}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Một câu điều kiện trên nhiều cột}
\NormalTok{df[df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{5} \OperatorTok{*}\NormalTok{ df[}\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{              state  individuals  family\_members  state\_pop}
\NormalTok{region                                                     }
\NormalTok{Pacific  California     109008.0         20964.0   39461588}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}
Bạn cũng có thể dùng \texttt{loc} để vừa lọc các dòng thỏa điều kiện, vừa chọn các cột muốn lấy
\end{rmdtip}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[df[}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{5} \OperatorTok{*}\NormalTok{ df[}\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{], [}\StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{         individuals  family\_members}
\NormalTok{region                              }
\NormalTok{Pacific     109008.0         20964.0}
\end{Highlighting}
\end{Shaded}

Ngoài ra, \texttt{pandas} còn cho phép bạn lọc với cấu trúc câu truy vấn bằng \texttt{.query} theo cú pháp

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.query(expr, inplace}\OperatorTok{=}\VariableTok{False}\NormalTok{, }\OperatorTok{**}\NormalTok{kwargs)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{expr}: là câu truy vấn
\item
  \texttt{inplace}: thực hiện trên chính \texttt{DataFrame} đó hay tạo 1 bảng sao
\item
  \texttt{**kwargs}: keyword arguments
\end{itemize}

Theo ví dụ trên, để thực hiện lọc theo điều kiện \texttt{df{[}\textquotesingle{}individuals\textquotesingle{}{]}\ \textgreater{}\ 5000} và \texttt{df{[}\textquotesingle{}family\_members\textquotesingle{}{]}\ \textless{}\ 10000} ta có thể làm như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.query(}\StringTok{\textquotesingle{}individuals \textgreater{} 500 and family\_members \textless{} 10000\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{             state  individuals  family\_members  state\_pop}
\NormalTok{region                                                    }
\NormalTok{Mountain   Arizona       7259.0          2606.0    7158024}
\NormalTok{Mountain  Colorado       7607.0          3250.0    5691287}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{\texttt{.isin()}}{.isin()}}\label{isin}

Phương thức \texttt{.isin(values)} để kiểm tra các phần tử trong \texttt{DataFrame} hoặc \texttt{Series} có nằm trong values hay không.

Ví dụ:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{, }\DecValTok{7259}\NormalTok{, }\DecValTok{582}\NormalTok{, }\DecValTok{300}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{          state  individuals  family\_members  state\_pop}
\NormalTok{region                                                 }
\NormalTok{Mountain   True         True           False      False}
\NormalTok{Mountain  False        False           False      False}
\NormalTok{Mountain  False        False           False      False}
\NormalTok{Pacific    True        False            True      False}
\NormalTok{Pacific   False        False           False      False}
\NormalTok{Pacific   False        False           False      False}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}state\textquotesingle{}}\NormalTok{].isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{region}
\NormalTok{Mountain     True}
\NormalTok{Mountain    False}
\NormalTok{Mountain    False}
\NormalTok{Pacific      True}
\NormalTok{Pacific     False}
\NormalTok{Pacific     False}
\NormalTok{Name: state, dtype: bool}
\end{Highlighting}
\end{Shaded}

Ngoài ra bạn có thể truyền \texttt{values} là một \texttt{dictionary} để kiểm tra cho từng cột theo từng tập giá trị

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.isin(\{}\StringTok{\textquotesingle{}state\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{], }
         \StringTok{\textquotesingle{}individuals\textquotesingle{}}\NormalTok{: [}\DecValTok{7259}\NormalTok{, }\DecValTok{582}\NormalTok{, }\DecValTok{300}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{          state  individuals  family\_members  state\_pop}
\NormalTok{region                                                 }
\NormalTok{Mountain   True         True           False      False}
\NormalTok{Mountain  False        False           False      False}
\NormalTok{Mountain  False        False           False      False}
\NormalTok{Pacific    True        False           False      False}
\NormalTok{Pacific   False        False           False      False}
\NormalTok{Pacific   False        False           False      False}
\end{Highlighting}
\end{Shaded}

Lọc với \texttt{.isin()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[df[}\StringTok{\textquotesingle{}state\textquotesingle{}}\NormalTok{].isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{])]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{            state  individuals  family\_members  state\_pop}
\NormalTok{region                                                   }
\NormalTok{Mountain  Arizona       7259.0          2606.0    7158024}
\NormalTok{Pacific    Alaska       1434.0           582.0     735139}
\end{Highlighting}
\end{Shaded}

trong trường hợp sự dụng \texttt{.isin} với \texttt{DataFrame}, kết quả của lọc sẽ trả về một \texttt{DataFrame} với giá trị các phần tử mà phép \texttt{isin} trả về \texttt{True}, các phần tử còn lại trả giá trị \texttt{NaN}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[df.isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{, }\DecValTok{7259}\NormalTok{, }\DecValTok{582}\NormalTok{, }\DecValTok{300}\NormalTok{])]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{            state  individuals  family\_members  state\_pop}
\NormalTok{region                                                   }
\NormalTok{Mountain  Arizona       7259.0             NaN        NaN}
\NormalTok{Mountain      NaN          NaN             NaN        NaN}
\NormalTok{Mountain      NaN          NaN             NaN        NaN}
\NormalTok{Pacific    Alaska          NaN           582.0        NaN}
\NormalTok{Pacific       NaN          NaN             NaN        NaN}
\NormalTok{Pacific       NaN          NaN             NaN        NaN}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}

\begin{itemize}
\item
  Bạn có dùng \texttt{.any()} để tổng hợp điều kiện của 1 DataFrame với các phần tử \texttt{boolean}
\item
  \texttt{.any(axis=1)} : Chỉ cần tồn tại 1 cột giá trị True, trả về giá trị True cho dòng
\item
  \texttt{.any(axis=0)}: Chỉ cần tồn tại 1 dòng có giá trị True, trả về giá trị True cho cột.
\item
  Phương thức \texttt{.any()} thường dùng để kiểm tra các dòng tồn tại 1 cột giá trị \texttt{NaN}
  \end{rmdtip}
\end{itemize}

Lọc với \texttt{.isin()} và \texttt{any(axis=1)}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{, }\DecValTok{7259}\NormalTok{, }\DecValTok{582}\NormalTok{, }\DecValTok{300}\NormalTok{]).}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{region}
\NormalTok{Mountain     True}
\NormalTok{Mountain    False}
\NormalTok{Mountain    False}
\NormalTok{Pacific      True}
\NormalTok{Pacific     False}
\NormalTok{Pacific     False}
\NormalTok{dtype: bool}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[df.isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{, }\DecValTok{7259}\NormalTok{, }\DecValTok{582}\NormalTok{, }\DecValTok{300}\NormalTok{]).}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{            state  individuals  family\_members  state\_pop}
\NormalTok{region                                                   }
\NormalTok{Mountain  Arizona       7259.0          2606.0    7158024}
\NormalTok{Pacific    Alaska       1434.0           582.0     735139}
\end{Highlighting}
\end{Shaded}

Lọc với \texttt{isin()} và \texttt{any(axis=0)}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{, }\DecValTok{7259}\NormalTok{, }\DecValTok{582}\NormalTok{, }\DecValTok{300}\NormalTok{]).}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{state              True}
\NormalTok{individuals        True}
\NormalTok{family\_members     True}
\NormalTok{state\_pop         False}
\NormalTok{dtype: bool}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.loc[:,df.isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{, }\DecValTok{7259}\NormalTok{, }\DecValTok{582}\NormalTok{, }\DecValTok{300}\NormalTok{]).}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members}
\NormalTok{region                                           }
\NormalTok{Mountain     Arizona       7259.0          2606.0}
\NormalTok{Mountain    Colorado       7607.0          3250.0}
\NormalTok{Mountain       Idaho       1297.0           715.0}
\NormalTok{Pacific       Alaska       1434.0           582.0}
\NormalTok{Pacific   California     109008.0         20964.0}
\NormalTok{Pacific       Hawaii       4131.0          2399.0}
\end{Highlighting}
\end{Shaded}

Lọc với \texttt{isin()} và \texttt{any(axis=0)} và \texttt{any(axis=1)}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bool\_df }\OperatorTok{=}\NormalTok{ df.isin([}\StringTok{\textquotesingle{}Alaska\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Illinois\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Arizona\textquotesingle{}}\NormalTok{, }\DecValTok{7259}\NormalTok{, }\DecValTok{582}\NormalTok{, }\DecValTok{300}\NormalTok{])}
\NormalTok{df.loc[bool\_df.}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{), bool\_df.}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{            state  individuals  family\_members}
\NormalTok{region                                        }
\NormalTok{Mountain  Arizona       7259.0          2606.0}
\NormalTok{Pacific    Alaska       1434.0           582.0}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{Lọc missing value với \texttt{.dropna()}}{Lọc missing value với .dropna()}}\label{lux1ecdc-missing-value-vux1edbi-.dropna}

Trong quá trình xử lý dữ liệu, chúng ta thường gặp những bảng có chứa giá trị missing value. Ví dụ bảng \texttt{missing\_df}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members   state\_pop}
\NormalTok{region                                                       }
\NormalTok{Mountain     Arizona       }\FloatTok{7259.0}\NormalTok{             NaN         NaN}
\NormalTok{Mountain    Colorado          NaN          }\FloatTok{3250.0}   \FloatTok{5691287.0}
\NormalTok{Mountain       Idaho       }\FloatTok{1297.0}           \FloatTok{715.0}   \FloatTok{1750536.0}
\NormalTok{Pacific       Alaska       }\FloatTok{1434.0}\NormalTok{             NaN    }\FloatTok{735139.0}
\NormalTok{Pacific   California     }\FloatTok{109008.0}         \FloatTok{20964.0}  \FloatTok{39461588.0}
\NormalTok{Pacific       Hawaii       }\FloatTok{4131.0}          \FloatTok{2399.0}\NormalTok{         NaN}
\end{Highlighting}
\end{Shaded}

Để lọc dữ liệu chứa \texttt{NaN} ta dùng phương thức \texttt{.dropna()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.dropna(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{, how}\OperatorTok{=}\StringTok{\textquotesingle{}any\textquotesingle{}}\NormalTok{, thresh}\OperatorTok{=}\VariableTok{None}\NormalTok{, subset}\OperatorTok{=}\VariableTok{None}\NormalTok{, inplace}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{axis}: Nhận diện lọc theo dòng \texttt{0}, \texttt{index}, hay cột \texttt{1}, \texttt{column}
\item
  \texttt{how}: Chỉ định cách lọc

  \begin{itemize}
  \tightlist
  \item
    \texttt{any}: Nếu có bất kì \texttt{NA}, loại bỏ dòng hoặc cột
  \item
    \texttt{all}: Nếu tất cả là \texttt{NA}, loại bỏ dòng hoặc cột
  \end{itemize}
\item
  \texttt{thresh}: Số lượng \texttt{non-NA} yêu cầu
\item
  \texttt{subset}: Chỉ định các cột cần lọc
\item
  \texttt{inplace}: Thực hiện trên chính \texttt{DataFrame} hay tạo bản sao.
\end{itemize}

Lọc bỏ các hàng nếu ít nhất một phần tử \texttt{NA}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{missing\_df.dropna(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members   state\_pop}
\NormalTok{region                                                       }
\NormalTok{Mountain       Idaho       1297.0           715.0   1750536.0}
\NormalTok{Pacific   California     109008.0         20964.0  39461588.0}
\end{Highlighting}
\end{Shaded}

Lọc bỏ các cột nếu ít nhất một phần tử \texttt{NA}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{missing\_df.dropna(axis}\OperatorTok{=}\StringTok{\textquotesingle{}columns\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state}
\NormalTok{region              }
\NormalTok{Mountain     Arizona}
\NormalTok{Mountain    Colorado}
\NormalTok{Mountain       Idaho}
\NormalTok{Pacific       Alaska}
\NormalTok{Pacific   California}
\NormalTok{Pacific       Hawaii}
\end{Highlighting}
\end{Shaded}

Lọc bỏ các dòng nếu tất cả phần tử trong các cột \texttt{{[}\textquotesingle{}family\_members\textquotesingle{},\ \textquotesingle{}state\_pop\textquotesingle{}{]}} là \texttt{NA}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{missing\_df.dropna(axis}\OperatorTok{=}\StringTok{\textquotesingle{}index\textquotesingle{}}\NormalTok{, how}\OperatorTok{=}\StringTok{\textquotesingle{}all\textquotesingle{}}\NormalTok{, subset}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}family\_members\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}state\_pop\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members   state\_pop}
\NormalTok{region                                                       }
\NormalTok{Mountain    Colorado          NaN          3250.0   5691287.0}
\NormalTok{Mountain       Idaho       1297.0           715.0   1750536.0}
\NormalTok{Pacific       Alaska       1434.0             NaN    735139.0}
\NormalTok{Pacific   California     109008.0         20964.0  39461588.0}
\NormalTok{Pacific       Hawaii       4131.0          2399.0         NaN}
\end{Highlighting}
\end{Shaded}

Giữ lại các dòng có ít nhất \texttt{3} phần tử \texttt{non-NA}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{missing\_df.dropna(thresh}\OperatorTok{=}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{               state  individuals  family\_members   state\_pop}
\NormalTok{region                                                       }
\NormalTok{Mountain    Colorado          NaN          3250.0   5691287.0}
\NormalTok{Mountain       Idaho       1297.0           715.0   1750536.0}
\NormalTok{Pacific       Alaska       1434.0             NaN    735139.0}
\NormalTok{Pacific   California     109008.0         20964.0  39461588.0}
\NormalTok{Pacific       Hawaii       4131.0          2399.0         NaN}
\end{Highlighting}
\end{Shaded}

\chapter{Tính toán trên các phần tử trong Pandas}\label{tuxednh-touxe1n-truxean-cuxe1c-phux1ea7n-tux1eed-trong-pandas}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}data/big\_mart\_sales.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Sử dụng Vectorization}\label{sux1eed-dux1ee5ng-vectorization}

Giả sử như muốn tạo cột \texttt{price}= \texttt{Item\_Outlet\_Sales} * \texttt{5\%}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}price\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ df[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{] }\OperatorTok{*} \FloatTok{0.05}
\NormalTok{df[[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}price\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{      Item\_Outlet\_Sales      price}
\NormalTok{0             3735.1380  186.75690}
\NormalTok{1              443.4228   22.17114}
\NormalTok{2             2097.2700  104.86350}
\NormalTok{3              732.3800   36.61900}
\NormalTok{4              994.7052   49.73526}
\NormalTok{...                 ...        ...}
\NormalTok{8518          2778.3834  138.91917}
\NormalTok{8519           549.2850   27.46425}
\NormalTok{8520          1193.1136   59.65568}
\NormalTok{8521          1845.5976   92.27988}
\NormalTok{8522           765.6700   38.28350}
\end{Highlighting}
\end{Shaded}

Nối hai cột lại với nhau, Ví dụ

\begin{itemize}
\item
  nối \texttt{Item\_type} và \texttt{Item\_Fat\_Content} thành \texttt{Item\_Type\_Fat\_Content}
\item
  nối \texttt{Outlet\_Identifier} và \texttt{Outlet\_Establishment\_Year} thành \texttt{Outlet\_Identifier\_Establishment\_Year}. Trong trường hợp hợp này \texttt{Outlet\_Establishment\_Year} thuộc dạng số nên để nối dạng text và số ta ép kiểu dạng số về text sử dụng \texttt{astype()}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}Item\_Type\_Fat\_Content\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ df[}\StringTok{\textquotesingle{}Item\_Type\textquotesingle{}}\NormalTok{] }\OperatorTok{+} \StringTok{\textquotesingle{}\_\textquotesingle{}} \OperatorTok{+}\NormalTok{ df[}\StringTok{\textquotesingle{}Item\_Fat\_Content\textquotesingle{}}\NormalTok{]}
\NormalTok{df[}\StringTok{\textquotesingle{}Outlet\_Identifier\_Establishment\_Year\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ df[}\StringTok{\textquotesingle{}Outlet\_Identifier\textquotesingle{}}\NormalTok{] }\OperatorTok{+} \StringTok{\textquotesingle{}\_\textquotesingle{}} \OperatorTok{+}\NormalTok{df[}\StringTok{\textquotesingle{}Outlet\_Establishment\_Year\textquotesingle{}}\NormalTok{].astype(}\StringTok{\textquotesingle{}str\textquotesingle{}}\NormalTok{)}
\NormalTok{df[[}\StringTok{\textquotesingle{}Item\_Type\_Fat\_Content\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Outlet\_Identifier\_Establishment\_Year\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{              Item\_Type\_Fat\_Content Outlet\_Identifier\_Establishment\_Year}
\NormalTok{0                     Dairy\_Low Fat                          OUT049\_1999}
\NormalTok{1               Soft Drinks\_Regular                          OUT018\_2009}
\NormalTok{2                      Meat\_Low Fat                          OUT049\_1999}
\NormalTok{3     Fruits and Vegetables\_Regular                          OUT010\_1998}
\NormalTok{4                 Household\_Low Fat                          OUT013\_1987}
\NormalTok{...                             ...                                  ...}
\NormalTok{8518            Snack Foods\_Low Fat                          OUT013\_1987}
\NormalTok{8519           Baking Goods\_Regular                          OUT045\_2002}
\NormalTok{8520     Health and Hygiene\_Low Fat                          OUT035\_2004}
\NormalTok{8521            Snack Foods\_Regular                          OUT018\_2009}
\NormalTok{8522            Soft Drinks\_Low Fat                          OUT046\_1997}
\end{Highlighting}
\end{Shaded}

\section{Sử dụng apply}\label{sux1eed-dux1ee5ng-apply}

Phương thức \texttt{apply} để thực thi một hàm theo dòng hoặc cột

\subsection{Sử dụng apply lên Series}\label{sux1eed-dux1ee5ng-apply-luxean-series}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Series.}\BuiltInTok{apply}\NormalTok{(func, convert\_dtype}\OperatorTok{=}\VariableTok{True}\NormalTok{, args}\OperatorTok{=}\NormalTok{(), }\OperatorTok{**}\NormalTok{kwargs)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{func}: là hàm cần thực thi
\item
  \texttt{convert\_dtype}: Giá trị kiểu boolean. Nếu nó được đặt thành True (mặc định), xử lý dữ liệu sẽ cố gắng tìm dtype tốt hơn cho các kết quả của hàm \texttt{func}. Nếu \texttt{False}, thì dtype sẽ là type(object)
\item
  \texttt{args}: Các đối số của hàm
\end{itemize}

Ví dụ, thao tác \texttt{Item\_Outlet\_Sales} * \texttt{5\%}

Sử dụng lambda function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{].}\BuiltInTok{apply}\NormalTok{(}\KeywordTok{lambda}\NormalTok{ x: x }\OperatorTok{*} \FloatTok{0.05}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0       186.75690}
\NormalTok{1        22.17114}
\NormalTok{2       104.86350}
\NormalTok{3        36.61900}
\NormalTok{4        49.73526}
\NormalTok{          ...    }
\NormalTok{8518    138.91917}
\NormalTok{8519     27.46425}
\NormalTok{8520     59.65568}
\NormalTok{8521     92.27988}
\NormalTok{8522     38.28350}
\NormalTok{Name: Item\_Outlet\_Sales, Length: 8523, dtype: float64}
\end{Highlighting}
\end{Shaded}

Sử dụng hàm tự định nghĩa

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ set\_price(x, k}\OperatorTok{=}\FloatTok{0.05}\NormalTok{):}
    \ControlFlowTok{return}\NormalTok{ x }\OperatorTok{*}\NormalTok{ k}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{].}\BuiltInTok{apply}\NormalTok{(set\_price)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0       186.75690}
\NormalTok{1        22.17114}
\NormalTok{2       104.86350}
\NormalTok{3        36.61900}
\NormalTok{4        49.73526}
\NormalTok{          ...    }
\NormalTok{8518    138.91917}
\NormalTok{8519     27.46425}
\NormalTok{8520     59.65568}
\NormalTok{8521     92.27988}
\NormalTok{8522     38.28350}
\NormalTok{Name: Item\_Outlet\_Sales, Length: 8523, dtype: float64}
\end{Highlighting}
\end{Shaded}

Có thể truyền tham số \texttt{k} vào hàm \texttt{set\_price} bằng hai cách

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Cách 1 {-} Dùng lambda}
\NormalTok{df[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{].}\BuiltInTok{apply}\NormalTok{(}\KeywordTok{lambda}\NormalTok{ x: set\_price(x, }\FloatTok{0.1}\NormalTok{))}

\CommentTok{\# Cách 2 {-} Dùng \textasciigrave{}arg\textasciigrave{}}
\NormalTok{df[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{].}\BuiltInTok{apply}\NormalTok{(set\_price, k}\OperatorTok{=}\FloatTok{0.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{\texorpdfstring{Sử dụng apply lên \texttt{DataFrame}**}{Sử dụng apply lên DataFrame**}}\label{sux1eed-dux1ee5ng-apply-luxean-dataframe}

Ta dùng cú pháp

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.}\BuiltInTok{apply}\NormalTok{(func, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{, raw}\OperatorTok{=}\VariableTok{False}\NormalTok{, result\_type}\OperatorTok{=}\VariableTok{None}\NormalTok{, args}\OperatorTok{=}\NormalTok{(), }\OperatorTok{**}\NormalTok{kwargs)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{func}: là hàm cần thực thi
\item
  \texttt{axis}: thực thi theo dòng \texttt{0} hoặc cột \texttt{1}
\item
  \texttt{raw}: Xác định xem dòng hoặc cột có thể chuyển về \texttt{Series} hoặc \texttt{ndarray}
\item
  \texttt{result\_type}: Chỉ áp dụng cho \texttt{axis=1}
\item
  \texttt{args}: Các đối số của hàm
\end{itemize}

Ví dụ:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sample\_df }\OperatorTok{=}\NormalTok{ sample\_df }\OperatorTok{=}\NormalTok{ pd.DataFrame([[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{], [}\DecValTok{3}\NormalTok{, }\DecValTok{6}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{], [}\DecValTok{5}\NormalTok{, }\DecValTok{10}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{]], columns}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}C\textquotesingle{}}\NormalTok{])}
\NormalTok{sample\_df}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   A   B  C}
\NormalTok{0  1   2  A}
\NormalTok{1  3   6  B}
\NormalTok{2  5  10  C}
\end{Highlighting}
\end{Shaded}

Áp dụng trên toàn \texttt{DataFrame}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sample\_df.}\BuiltInTok{apply}\NormalTok{(}\KeywordTok{lambda}\NormalTok{ x: x }\OperatorTok{*} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{     A   B   C}
\NormalTok{0    2   4  AA}
\NormalTok{1    6  12  BB}
\NormalTok{2   10  20  CC}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}

Khi áp dụng cho toàn \texttt{DataFrame} hãy cẩn thận hàm \texttt{func} truyền vào, nếu \texttt{func} không áp dụng được cho toàn bộ các phần tử sẽ báo lỗi.

Ví dụ ở trên với x * 2 vẫn áp dụng được cho cột \texttt{C} dạng \texttt{str}, nhưng khi thay bằng x ** 2 sẽ báo lỗi vì toán tử \texttt{**} không áp dụng cho \texttt{str}
\end{rmdnote}

Áp dụng trên một số cột trong \texttt{DataFrame}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Theo cột}
\NormalTok{sample\_df[[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{]].}\BuiltInTok{apply}\NormalTok{(np.}\BuiltInTok{sum}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0    13}
\NormalTok{1    13}
\NormalTok{2    13}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Theo dòng}
\NormalTok{df[[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{]].}\BuiltInTok{apply}\NormalTok{(}\KeywordTok{lambda}\NormalTok{ x: np.}\BuiltInTok{sum}\NormalTok{(x), axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A    12}
\NormalTok{B    27}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

Một cách khác áp dụng trên một số cột trong \texttt{DataFrame}

Sử dụng lambda

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sample\_df.}\BuiltInTok{apply}\NormalTok{(}\KeywordTok{lambda}\NormalTok{ x: x[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{] }\OperatorTok{+} \DecValTok{2} \OperatorTok{*}\NormalTok{ x[}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{], axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0     5}
\NormalTok{1    15}
\NormalTok{2    25}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

Dùng hàm định nghĩa

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ dsum(row):}
    \ControlFlowTok{return}\NormalTok{ row[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{] }\OperatorTok{+} \DecValTok{2} \OperatorTok{*}\NormalTok{ row[}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sample\_df.}\BuiltInTok{apply}\NormalTok{(dsum, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0     5}
\NormalTok{1    15}
\NormalTok{2    25}
\NormalTok{dtype: int64}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}}

\begin{itemize}
\item
  Không nhất thiết giá trị trả về của hàm là giá trị đơn, giá trị trả về có thể dưới dạng list, tuple hoặc dict
\item
  Dùng \texttt{result\_type} để thay đổi cách trả về
  \end{rmdtip}
\end{itemize}

Ví dụ ta có 1 hàm trả về nhiều giá trị cùng lúc như sau

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ dsum\_2(row):}
    \ControlFlowTok{return}\NormalTok{ [row[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{] }\OperatorTok{+} \DecValTok{2} \OperatorTok{*}\NormalTok{ row[}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{],  row[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{] }\OperatorTok{{-}} \DecValTok{2} \OperatorTok{*}\NormalTok{ row[}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\# Khi không sử dụng \textasciigrave{}result\_type\textasciigrave{}}
\NormalTok{sample\_df.}\BuiltInTok{apply}\NormalTok{(dsum\_2, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0      [5, {-}3]}
\NormalTok{1     [15, {-}9]}
\NormalTok{2    [25, {-}15]}
\NormalTok{dtype: object}
\end{Highlighting}
\end{Shaded}

Kết quả trả về của phương pháp trên là \texttt{Series} với các giá trị của nó là dạng list. Để chuyển \texttt{Series} này thành \texttt{DataFrame} với các cột chứa các giá trị của list theo thứ tự, ta dùng \texttt{result\_type=\textquotesingle{}expand\textquotesingle{}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sample\_df.}\BuiltInTok{apply}\NormalTok{(dsum\_2, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{, result\_type}\OperatorTok{=}\StringTok{\textquotesingle{}expand\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    0   1}
\NormalTok{0   5  {-}3}
\NormalTok{1  15  {-}9}
\NormalTok{2  25 {-}15}
\end{Highlighting}
\end{Shaded}

\begin{rmdtip}
\textbf{\emph{Mẹo:}} Có thể cấu trúc trả về dưới dạng \texttt{DataFrame} cho ví dụ trên mà không cần dùng \texttt{result\_type} bằng cách sử dụng \texttt{pd.Series} của một \texttt{dictionary}. Lúc này các cột của \texttt{DataFrame} sẽ được đánh nhãn theo key của \texttt{dictionary}
\end{rmdtip}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ dsum\_3(row):}
    \ControlFlowTok{return}\NormalTok{ pd.Series(\{}\StringTok{\textquotesingle{}X\textquotesingle{}}\NormalTok{: row[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{] }\OperatorTok{+} \DecValTok{2} \OperatorTok{*}\NormalTok{ row[}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{],  }\StringTok{\textquotesingle{}Y\textquotesingle{}}\NormalTok{:row[}\StringTok{\textquotesingle{}A\textquotesingle{}}\NormalTok{] }\OperatorTok{{-}} \DecValTok{2} \OperatorTok{*}\NormalTok{ row[}\StringTok{\textquotesingle{}B\textquotesingle{}}\NormalTok{]\})}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sample\_df.}\BuiltInTok{apply}\NormalTok{(dsum\_3, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    X   Y}
\NormalTok{0   5   {-}3}
\NormalTok{1   15  {-}9}
\NormalTok{2   25  {-}15}
\end{Highlighting}
\end{Shaded}

\section{Sử dụng iterator}\label{sux1eed-dux1ee5ng-iterator}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}data/big\_mart\_sales.csv\textquotesingle{}}\NormalTok{, usecols}\OperatorTok{=}\NormalTok{[}\StringTok{\textquotesingle{}Item\_Identifier\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Item\_Fat\_Content\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Item\_Type\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Outlet\_Size\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Outlet\_Establishment\_Year\textquotesingle{}}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\subsection{Iterrows}\label{iterrows}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.iterrows()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{row }\OperatorTok{=} \BuiltInTok{next}\NormalTok{(df.iterrows())}
\NormalTok{row}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(0,}
\NormalTok{ Item\_Identifier                 FDA15}
\NormalTok{ Item\_Fat\_Content              Low Fat}
\NormalTok{ Item\_Type                       Dairy}
\NormalTok{ Outlet\_Establishment\_Year        1999}
\NormalTok{ Outlet\_Size                    Medium}
\NormalTok{ Item\_Outlet\_Sales            3735.138}
\NormalTok{ Name: 0, dtype: object)}
\end{Highlighting}
\end{Shaded}

Kết quả trả về cho row là 1 tuple gồm index và Series chứa các giá trị tại index đó.

\textbf{Cách dùng vòng lặp trong iterrows}

Để duyệt từng dòng ta dùng \texttt{for} như bình thường

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prices }\OperatorTok{=}\NormalTok{ []}
\ControlFlowTok{for}\NormalTok{ i, row }\KeywordTok{in}\NormalTok{ df.iterrows():}
\NormalTok{    prices.append(row[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{] }\OperatorTok{*} \FloatTok{0.5}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(prices[:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{[1867.569, 221.7114, 1048.635, 366.19, 497.3526]}
\end{Highlighting}
\end{Shaded}

\subsection{Itertuple}\label{itertuple}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.itertuples(index}\OperatorTok{=}\VariableTok{True}\NormalTok{, name}\OperatorTok{=}\StringTok{\textquotesingle{}Pandas\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó:

\begin{itemize}
\item
  \texttt{index}: \texttt{True} trả về kết quả kèm theo index và \texttt{False} lược bỏ index
\item
  \texttt{name}: Quy định kiểu trả về

  \begin{itemize}
  \tightlist
  \item
    \texttt{Pandas}: trả về namedtuple
  \item
    \texttt{None}: trả về tuple
  \item
    \texttt{namedtuple}: trả về namedtuple
  \end{itemize}
\end{itemize}

Trả về \texttt{namedtuple}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{next}\NormalTok{(df.itertuples(index}\OperatorTok{=}\VariableTok{True}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Pandas(Index=0, Item\_Identifier=\textquotesingle{}FDA15\textquotesingle{}, Item\_Fat\_Content=\textquotesingle{}Low Fat\textquotesingle{}, Item\_Type=\textquotesingle{}Dairy\textquotesingle{}, Outlet\_Establishment\_Year=1999, Outlet\_Size=\textquotesingle{}Medium\textquotesingle{}, Item\_Outlet\_Sales=3735.138)}
\end{Highlighting}
\end{Shaded}

Trả về \texttt{tuple}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{next}\NormalTok{(df.itertuples(index}\OperatorTok{=}\VariableTok{False}\NormalTok{, name}\OperatorTok{=}\VariableTok{None}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(\textquotesingle{}FDA15\textquotesingle{}, \textquotesingle{}Low Fat\textquotesingle{}, \textquotesingle{}Dairy\textquotesingle{}, 1999, \textquotesingle{}Medium\textquotesingle{}, 3735.138)}
\end{Highlighting}
\end{Shaded}

\textbf{Cách dùng vòng lặp trong itertuples}

\texttt{name=default}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prices }\OperatorTok{=}\NormalTok{ []}
\ControlFlowTok{for}\NormalTok{ row }\KeywordTok{in}\NormalTok{ df.itertuples():}
\NormalTok{    prices.append(row.Item\_Outlet\_Sales }\OperatorTok{*} \FloatTok{0.5}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(prices[:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\texttt{name=None}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prices }\OperatorTok{=}\NormalTok{ []}
\ControlFlowTok{for}\NormalTok{ row }\KeywordTok{in}\NormalTok{ df.itertuples(index}\OperatorTok{=}\VariableTok{False}\NormalTok{, name}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
\NormalTok{    prices.append(row[}\DecValTok{5}\NormalTok{] }\OperatorTok{*} \FloatTok{0.5}\NormalTok{)}
\BuiltInTok{print}\NormalTok{(prices[:}\DecValTok{5}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\section{So sánh các phương pháp lặp}\label{so-suxe1nh-cuxe1c-phux1b0ux1a1ng-phuxe1p-lux1eb7p}

\begin{Shaded}
\begin{Highlighting}[]

\KeywordTok{def}\NormalTok{ vectorizer(df):}
\NormalTok{    prices }\OperatorTok{=}\NormalTok{ df[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{] }\OperatorTok{*} \FloatTok{0.5}

\KeywordTok{def}\NormalTok{ applyer(df):}
\NormalTok{    prices }\OperatorTok{=}\NormalTok{ df[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{].}\BuiltInTok{apply}\NormalTok{(}\KeywordTok{lambda}\NormalTok{ x: x }\OperatorTok{*} \FloatTok{0.5}\NormalTok{)}

\KeywordTok{def}\NormalTok{ iterrows(df):}
\NormalTok{    prices }\OperatorTok{=}\NormalTok{ []}
    \ControlFlowTok{for}\NormalTok{ i, row }\KeywordTok{in}\NormalTok{ df.iterrows():}
\NormalTok{        prices.append(row[}\StringTok{\textquotesingle{}Item\_Outlet\_Sales\textquotesingle{}}\NormalTok{] }\OperatorTok{*} \FloatTok{0.5}\NormalTok{)}

\KeywordTok{def}\NormalTok{ itertuples1(df):}
\NormalTok{    prices }\OperatorTok{=}\NormalTok{ []}
    \ControlFlowTok{for}\NormalTok{ row }\KeywordTok{in}\NormalTok{ df.itertuples():}
\NormalTok{        prices.append(row.Item\_Outlet\_Sales }\OperatorTok{*} \FloatTok{0.5}\NormalTok{)}

\KeywordTok{def}\NormalTok{ itertuples2(df):}
\NormalTok{    prices }\OperatorTok{=}\NormalTok{ []}
    \ControlFlowTok{for}\NormalTok{ row }\KeywordTok{in}\NormalTok{ df.itertuples(index}\OperatorTok{=}\VariableTok{False}\NormalTok{, name}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
\NormalTok{        prices.append(row[}\DecValTok{5}\NormalTok{] }\OperatorTok{*} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{\%}\NormalTok{timeit }\OperatorTok{{-}}\NormalTok{n }\DecValTok{10}\NormalTok{ vectorizer(df)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{80.1 µs ± 42.8 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{\%}\NormalTok{timeit }\OperatorTok{{-}}\NormalTok{n }\DecValTok{10}\NormalTok{ applyer(df)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{1.37 ms ± 112 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{\%}\NormalTok{timeit }\OperatorTok{{-}}\NormalTok{n }\DecValTok{10}\NormalTok{ iterrows(df)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{256 ms ± 2.48 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{\%}\NormalTok{timeit }\OperatorTok{{-}}\NormalTok{n }\DecValTok{10}\NormalTok{ itertuples1(df)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{6.61 ms ± 200 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{\%}\NormalTok{timeit }\OperatorTok{{-}}\NormalTok{n }\DecValTok{10}\NormalTok{ itertuples2(df)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{3.91 ms ± 132 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)}
\end{Highlighting}
\end{Shaded}

\section{Xử lý song song trong pandas}\label{xux1eed-luxfd-song-song-trong-pandas}

Xử lý song song là phương pháp tận dụng số lượng core của CPU để giải quyết vấn đề trong thời gian ngắn hơn.

\subsection{pandarallel}\label{pandarallel}

Để cài đặt pandarallel bằng \texttt{pip}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pip install pandarallel}
\end{Highlighting}
\end{Shaded}

Cách sử dụng

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ pandarallel }\ImportTok{import}\NormalTok{ pandarallel}
\NormalTok{pandarallel.initialize(progress\_bar}\OperatorTok{=}\VariableTok{True}\NormalTok{, n\_workers}\OperatorTok{=}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Để thiết lập cho pandarallel ta dùng \texttt{.initialize}. Trong đó:

\begin{itemize}
\item
  \texttt{n\_workers}: là số lượng cores của CPU
\item
  \texttt{progress\_bar}: show tiến trình
\end{itemize}

Để áp dụng pandarallel ta chỉ việc thay thế \texttt{.apply} bằng \texttt{.parallel\_apply}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# df.apply(func)}
\NormalTok{df.parallel\_apply(func)}
\end{Highlighting}
\end{Shaded}

\chapter{Các cách phối hợp nhiều bảng}\label{cuxe1c-cuxe1ch-phux1ed1i-hux1ee3p-nhiux1ec1u-bux1ea3ng}

\section{Join}\label{join}

\section{Merge}\label{merge}

\section{Concat}\label{concat}

\chapter{Groupby}\label{groupby}

\section{Groupby}\label{groupby-1}

Phương thức \texttt{.groupby} sẽ gom các dòng hoặc các cột thành các nhóm khác nhau. Cú pháp cơ bản của \texttt{.groupby} như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{DataFrame.groupby(by}\OperatorTok{=}\VariableTok{None}\NormalTok{, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{, dropna}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó

\begin{itemize}
\item
  \texttt{by}: có thể là dạng mapping, nhãn, danh sách nhãn hoặc một hàm trả về danh sách các index
\item
  \texttt{axis}: Tùy chọn group theo dòng \{\texttt{0} hoặc \texttt{index}\} hoặc cột \{\texttt{1} hoặc \texttt{columns}\}, mặc định là dòng.
\item
  \texttt{dropna}: Mặc định là \texttt{True} sẽ bỏ qua những dòng chứa \texttt{NA} và \texttt{False} sẽ thêm \texttt{NA} là một khóa trong nhóm, tương tự như \texttt{.value\_counts()}
\end{itemize}

Ví dụ với dữ liệu \href{https://www.kaggle.com/datasets/brijbhushannanda1979/bigmart-sales-data?select=Train.csv}{Big Mart Salses}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.head()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  Item\_Identifier              Item\_Type Outlet\_Size  Item\_Outlet\_Sales}
\NormalTok{0           FDA15                  Dairy      Medium          3735.1380}
\NormalTok{1           DRC01            Soft Drinks      Medium           443.4228}
\NormalTok{2           FDN15                   Meat      Medium          2097.2700}
\NormalTok{3           FDX07  Fruits and Vegetables         NaN           732.3800}
\NormalTok{4           NCD19              Household        High           994.7052}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{grouped }\OperatorTok{=}\NormalTok{ df.groupby(}\StringTok{\textquotesingle{}Item\_Type\textquotesingle{}}\NormalTok{)}
\BuiltInTok{type}\NormalTok{(grouped)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pandas.core.groupby.generic.DataFrameGroupBy}
\end{Highlighting}
\end{Shaded}

Để xem từng nhóm trong group, ta có thể sử dụng \texttt{.get\_groups()} và truyền key vào đó. Ví dụ với key \texttt{Dairy}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{grouped.get\_group(}\StringTok{\textquotesingle{}Dairy\textquotesingle{}}\NormalTok{).head()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   Item\_Identifier Item\_Type Outlet\_Size  Item\_Outlet\_Sales}
\NormalTok{0            FDA15     Dairy      Medium          3735.1380}
\NormalTok{11           FDA03     Dairy       Small          2187.1530}
\NormalTok{19           FDU02     Dairy       Small          2748.4224}
\NormalTok{28           FDE51     Dairy         NaN           178.4344}
\NormalTok{30           FDV38     Dairy         NaN           163.7868}
\end{Highlighting}
\end{Shaded}

Khi chọn 1 column sau khi \texttt{.groupby} sẽ trả về kiểu \texttt{pandas.core.groupby.generic.SeriesGroupBy}

\section{Các hàm Filtering trong Groupby}\label{cuxe1c-huxe0m-filtering-trong-groupby}

\textbf{\texttt{.head(n=5)}}

Trả về \texttt{n} dòng đầu của mỗi group.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.groupby([}\StringTok{\textquotesingle{}Item\_Type\textquotesingle{}}\NormalTok{]).head(n}\OperatorTok{=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    Item\_Identifier              Item\_Type Outlet\_Size  Item\_Outlet\_Sales}
\NormalTok{0             FDA15                  Dairy      Medium          3735.1380}
\NormalTok{1             DRC01            Soft Drinks      Medium           443.4228}
\NormalTok{2             FDN15                   Meat      Medium          2097.2700}
\NormalTok{3             FDX07  Fruits and Vegetables         NaN           732.3800}
\NormalTok{4             NCD19              Household        High           994.7052}
\NormalTok{5             FDP36           Baking Goods      Medium           556.6088}
\NormalTok{6             FDO10            Snack Foods        High           343.5528}
\NormalTok{7             FDP10            Snack Foods      Medium          4022.7636}
\NormalTok{8             FDH17           Frozen Foods         NaN          1076.5986}
\NormalTok{9             FDU28           Frozen Foods         NaN          4710.5350}
\NormalTok{10            FDY07  Fruits and Vegetables      Medium          1516.0266}
\NormalTok{11            FDA03                  Dairy       Small          2187.1530}
\NormalTok{15            FDP49              Breakfast       Small          1547.3192}
\NormalTok{16            NCB42     Health and Hygiene      Medium          1621.8888}
\NormalTok{17            FDP49              Breakfast      Medium           718.3982}
\NormalTok{18            DRI11            Hard Drinks      Medium          2303.6680}
\NormalTok{21            FDW12           Baking Goods      Medium          4064.0432}
\NormalTok{22            NCB30              Household       Small          1587.2672}
\NormalTok{27            DRJ59            Hard Drinks        High           308.9312}
\NormalTok{29            FDC14                 Canned       Small           125.8362}
\NormalTok{31            NCS17     Health and Hygiene      Medium          2741.7644}
\NormalTok{33            FDO23                 Breads         NaN          2174.5028}
\NormalTok{34            DRH01            Soft Drinks       Small          2085.2856}
\NormalTok{41            FDK43                   Meat        High          2150.5340}
\NormalTok{43            FDC02                 Canned      Medium          6768.5228}
\NormalTok{72            FDH35          Starchy Foods         NaN          4604.6728}
\NormalTok{114           FDV11                 Breads         NaN          3151.8972}
\NormalTok{136           FDH35          Starchy Foods      Medium          5262.4832}
\NormalTok{139           NCN07                 Others         NaN           263.6568}
\NormalTok{142           NCO55                 Others         NaN          2143.8760}
\NormalTok{231           FDG33                Seafood      Medium          3435.5280}
\NormalTok{713           FDH21                Seafood      Medium          1267.6832}
\end{Highlighting}
\end{Shaded}

\textbf{\texttt{.tail(n=5)}}

Trả về \texttt{n} dòng cuối của mỗi group

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df.groupby([}\StringTok{\textquotesingle{}Item\_Type\textquotesingle{}}\NormalTok{]).tail(n}\OperatorTok{=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{     Item\_Identifier              Item\_Type Outlet\_Size  Item\_Outlet\_Sales}
\NormalTok{8317           FDN13              Breakfast         NaN          1306.9654}
\NormalTok{8335           FDO49              Breakfast      Medium           708.4112}
\NormalTok{8370           FDV23                 Breads       Small           871.5322}
\NormalTok{8413           FDW59                 Breads       Small          1691.1320}
\NormalTok{8423           FDJ57                Seafood      Medium          2600.6148}
\NormalTok{8426           FDA22          Starchy Foods       Small          4512.1266}
\NormalTok{8457           FDY50                  Dairy       Small          1516.6924}
\NormalTok{8463           FDG59          Starchy Foods      Medium           810.9444}
\NormalTok{8473           DRI47            Hard Drinks         NaN           431.4384}
\NormalTok{8483           DRI11            Hard Drinks         NaN          1612.5676}
\NormalTok{8488           NCN14                 Others      Medium          2756.4120}
\NormalTok{8489           FDV13                 Canned      Medium          2109.2544}
\NormalTok{8491           FDO03                   Meat      Medium          4809.7392}
\NormalTok{8496           FDJ57                Seafood         NaN          3715.1640}
\NormalTok{8499           NCK53     Health and Hygiene       Small          2976.1260}
\NormalTok{8502           NCH43              Household         NaN          3020.0688}
\NormalTok{8504           NCN18              Household      Medium          4138.6128}
\NormalTok{8506           DRF37            Soft Drinks      Medium          3944.8650}
\NormalTok{8508           FDW31  Fruits and Vegetables         NaN          2587.9646}
\NormalTok{8509           FDG45  Fruits and Vegetables         NaN           424.7804}
\NormalTok{8511           FDF05           Frozen Foods      Medium          4207.8560}
\NormalTok{8512           FDR26                  Dairy        High          2479.4392}
\NormalTok{8513           FDH31                   Meat       Small           595.2252}
\NormalTok{8514           FDA01                 Canned         NaN           468.7232}
\NormalTok{8515           FDH24           Baking Goods      Medium          1571.2880}
\NormalTok{8516           NCJ19                 Others      Medium           858.8820}
\NormalTok{8517           FDF53           Frozen Foods       Small          3608.6360}
\NormalTok{8518           FDF22            Snack Foods        High          2778.3834}
\NormalTok{8519           FDS36           Baking Goods         NaN           549.2850}
\NormalTok{8520           NCJ29     Health and Hygiene       Small          1193.1136}
\NormalTok{8521           FDN46            Snack Foods      Medium          1845.5976}
\NormalTok{8522           DRG01            Soft Drinks       Small           765.6700}
\end{Highlighting}
\end{Shaded}

\begin{rmdnote}
\textbf{\emph{Lưu ý:}}
\texttt{.head()} và \texttt{.tail()} trả về các dòng theo thứ tự index của chúng, không trả về theo thứ tự sắp xếp theo key
\end{rmdnote}

\chapter{Xử lý một số kiểu dữ liệu trong Pandas}\label{xux1eed-luxfd-mux1ed9t-sux1ed1-kiux1ec3u-dux1eef-liux1ec7u-trong-pandas}

\section{Xử lý dữ liệu dạng text}\label{xux1eed-luxfd-dux1eef-liux1ec7u-dux1ea1ng-text}

Chúng ta có thể lưu dữ liệu text trong Pandas dưới hai dạng dữ liệu : object hoặc string\hspace{0pt}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series( [}\StringTok{"A"}\NormalTok{, }\StringTok{"B"}\NormalTok{, }\StringTok{"C"}\NormalTok{, }\StringTok{"Aaba"}\NormalTok{, }\StringTok{"Baca"}\NormalTok{, np.nan, }\StringTok{"CABA"}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"cat"}\NormalTok{], dtype}\OperatorTok{=}\StringTok{"string"}\NormalTok{)​}
\end{Highlighting}
\end{Shaded}

Để thực hiện các thao tác cho dữ liệu dạng text ta hay dùng \texttt{s.str.\textless{}phương\ thức\textgreater{}}.

\subsection{lower()}\label{lower}

Chúng ta có thể chuyển text về các kí tự viết thường bằng phương thức \texttt{lower()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.lower()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0       a}
\NormalTok{1       b}
\NormalTok{2       c}
\NormalTok{3    aaba}
\NormalTok{4    baca}
\NormalTok{5    \textless{}NA\textgreater{}}
\NormalTok{6    caba}
\NormalTok{7     dog}
\NormalTok{8     cat}
\end{Highlighting}
\end{Shaded}

\subsection{upper()}\label{upper}

Chúng ta có thể chuyển text về các kí tự viết hoa bằng phương thức \texttt{upper()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.upper()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0       A}
\NormalTok{1       B}
\NormalTok{2       C}
\NormalTok{3    AABA}
\NormalTok{4    BACA}
\NormalTok{5    \textless{}NA\textgreater{}}
\NormalTok{6    CABA}
\NormalTok{7     DOG}
\NormalTok{8     CAT}
\end{Highlighting}
\end{Shaded}

\subsection{split()}\label{split}

\subsubsection*{Thao tác cơ bản}\label{thao-tuxe1c-cux1a1-bux1ea3n}


split giúp cắt chuỗi theo một pattern cho trước, mặc định pattern là khoảng trắng

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s2 }\OperatorTok{=}\NormalTok{ pd.Series([}\StringTok{"a\_b\_c "}\NormalTok{, }\StringTok{"c\_d\_e"}\NormalTok{, np.nan, }\StringTok{"f\_g\_h"}\NormalTok{], dtype}\OperatorTok{=}\StringTok{"string"}\NormalTok{)}
\NormalTok{s2.}\BuiltInTok{str}\NormalTok{.split(}\StringTok{"\_"}\NormalTok{)​​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0    [a, b, c]​}
\NormalTok{1    [c, d, e]​}
\NormalTok{2         \textless{}NA\textgreater{}​}
\NormalTok{3    [f, g, h]​}
\end{Highlighting}
\end{Shaded}

Chúng ta có thể chỉ lấy phần tử thứ \texttt{i} sau khi split bằng hai cách

\begin{itemize}
\tightlist
\item
  Cách thứ nhất, dùng \texttt{get(i)}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s2.}\BuiltInTok{str}\NormalTok{.split(}\StringTok{"\_"}\NormalTok{).}\BuiltInTok{str}\NormalTok{.get(}\DecValTok{1}\NormalTok{)​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0       b​}
\NormalTok{1       d​}
\NormalTok{2    \textless{}NA\textgreater{}​}
\NormalTok{3       g}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Cách thứ hai, dùng \texttt{{[}i{]}}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s2.}\BuiltInTok{str}\NormalTok{.split(}\StringTok{"\_"}\NormalTok{).}\BuiltInTok{str}\NormalTok{[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0       b​}
\NormalTok{1       d​}
\NormalTok{2    \textless{}NA\textgreater{}​}
\NormalTok{3       g}
\end{Highlighting}
\end{Shaded}

\subsubsection*{Tách các phần tử thành nhiều Series}\label{tuxe1ch-cuxe1c-phux1ea7n-tux1eed-thuxe0nh-nhiux1ec1u-series}


Như cách split mặc định ở phần đầu, chúng ta có kết quả là một Series với mỗi phần tử là một danh sách

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s2.}\BuiltInTok{str}\NormalTok{.split(}\StringTok{"\_"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0    [a, b, c]​}
\NormalTok{1    [c, d, e]​}
\NormalTok{2         \textless{}NA\textgreater{}​}
\NormalTok{3    [f, g, h]​}
\end{Highlighting}
\end{Shaded}

Chúng ta có thể chia tách các danh sách thành các cột khác nhau bằng tham số \texttt{expand}, lúc này sẽ sinh ra một DataFrame mới với số cột bằng với số phần tử tối đa của các danh sách

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s2.}\BuiltInTok{str}\NormalTok{.split(}\StringTok{"\_"}\NormalTok{, expand}\OperatorTok{=}\VariableTok{True}\NormalTok{)​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{      0     1     2​}
\NormalTok{0     a     b     c​}
\NormalTok{1     c     d     e​}
\NormalTok{2  \textless{}NA\textgreater{}  \textless{}NA\textgreater{}  \textless{}NA\textgreater{}​}
\NormalTok{3     f     g     h}
\end{Highlighting}
\end{Shaded}

Ngoài ra, chúng ta cũng có thể chỉ định cắt theo vị trí bằng tham số \texttt{n}. Ví dụ chúng ta chỉ cắt chuỗi theo ký tự phân tách \texttt{\_} đầu tiên

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s2.}\BuiltInTok{str}\NormalTok{.split(}\StringTok{"\_"}\NormalTok{, expand}\OperatorTok{=}\VariableTok{True}\NormalTok{, n}\OperatorTok{=}\DecValTok{1}\NormalTok{)​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{      0     1}
\NormalTok{0     a   b\_c}
\NormalTok{1     c   d\_e}
\NormalTok{2  \textless{}NA\textgreater{}  \textless{}NA\textgreater{}}
\NormalTok{3     f   g\_h}
\end{Highlighting}
\end{Shaded}

\subsection{replace}\label{replace}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s3 }\OperatorTok{=}\NormalTok{ pd.Series(​}

\NormalTok{    [}\StringTok{"A "}\NormalTok{, }\StringTok{"B "}\NormalTok{, }\StringTok{"C "}\NormalTok{, }\StringTok{"Aaba "}\NormalTok{, }\StringTok{"Baca "}\NormalTok{, }\StringTok{""}\NormalTok{, np.nan, }\StringTok{"CABA "}\NormalTok{, }\StringTok{"dog "}\NormalTok{, }\StringTok{"cat"}\NormalTok{],​}

\NormalTok{    dtype}\OperatorTok{=}\StringTok{"string"}\NormalTok{,​}

\NormalTok{)​}
\NormalTok{s3}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0       A}
\NormalTok{1       B}
\NormalTok{2       C}
\NormalTok{3    Aaba}
\NormalTok{4    Baca}
\NormalTok{5        }
\NormalTok{6    \textless{}NA\textgreater{}}
\NormalTok{7    CABA}
\NormalTok{8     dog}
\NormalTok{9     cat}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s3.}\BuiltInTok{str}\NormalTok{.replace(}\StringTok{"\^{}.a|dog "}\NormalTok{, }\StringTok{"XX{-}XX "}\NormalTok{, case}\OperatorTok{=}\VariableTok{False}\NormalTok{, regex}\OperatorTok{=}\VariableTok{True}\NormalTok{)​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0           A}
\NormalTok{1           B}
\NormalTok{2           C}
\NormalTok{3    XX{-}XX ba}
\NormalTok{4    XX{-}XX ca}
\NormalTok{5            }
\NormalTok{6        \textless{}NA\textgreater{}}
\NormalTok{7    XX{-}XX BA}
\NormalTok{8      XX{-}XX }
\NormalTok{9     XX{-}XX t}
\end{Highlighting}
\end{Shaded}

\subsection{remove}\label{remove}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series([}\StringTok{"str\_foo "}\NormalTok{, }\StringTok{"str\_bar "}\NormalTok{, }\StringTok{"no\_prefix"}\NormalTok{])}
\NormalTok{s​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0             str\_foo}
\NormalTok{1             bar\_str}
\NormalTok{2    no\_prefix\_suffix}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.removeprefix(}\StringTok{"str\_"}\NormalTok{)​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0                 foo}
\NormalTok{1             bar\_str}
\NormalTok{2    no\_prefix\_suffix}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.removesuffix(}\StringTok{"\_str"}\NormalTok{)​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0             str\_foo}
\NormalTok{1                 bar}
\NormalTok{2    no\_prefix\_suffix}
\end{Highlighting}
\end{Shaded}

\subsection{concatenate}\label{concatenate}

Để nối các text với nhau, chúng ta có thể sử dụng phương thức .str.cat()\hspace{0pt}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Series.}\BuiltInTok{str}\NormalTok{.cat(others}\OperatorTok{=}\VariableTok{None}\NormalTok{, sep}\OperatorTok{=}\VariableTok{None}\NormalTok{, na\_rep}\OperatorTok{=}\VariableTok{None}\NormalTok{, join}\OperatorTok{=}\StringTok{"left"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Trong đó\hspace{0pt}

\begin{itemize}
\item
  others: có thể là Series, DataFrame, np.ndarray hoặc có thể là None\hspace{0pt}
\item
  sep: dùng để thể hiện phân cách giữa các thành phần sau khi nối\hspace{0pt}
\item
  na\_rep: thay thế các giá trị bị thiếu bằng một giá trị nào đó\hspace{0pt}
\item
  join: Nếu others là một series thì sẽ join 2 kết quả theo index và theo phương thức \{ ``left'', ``right'', ``outer'', ``inner''\}\hspace{0pt}
\end{itemize}

Khi không truyền gì cả vào others, toàn bộ giá trị của series sẽ nối về thành một string\hspace{0pt}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OperatorTok{=}\NormalTok{ pd.Series([}\StringTok{"a "}\NormalTok{, }\StringTok{"b "}\NormalTok{, }\StringTok{"c "}\NormalTok{, }\StringTok{"d"}\NormalTok{, np.nan], dtype}\OperatorTok{=}\StringTok{"string"}\NormalTok{)​}
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.cat()​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\textquotesingle{}abcd\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.cat(sep}\OperatorTok{=}\StringTok{","}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\textquotesingle{}a,b,c,d\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.cat(sep}\OperatorTok{=}\StringTok{"}\CharTok{\textbackslash{}t}\StringTok{"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\textquotesingle{}a\textbackslash{}tb\textbackslash{}tc\textbackslash{}td\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.cat(sep}\OperatorTok{=}\StringTok{","}\NormalTok{, na\_rep}\OperatorTok{=}\StringTok{"?"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{\textquotesingle{}a,b,c,d,?\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Khi truyền vào \texttt{cat} một List hoặc Array, bắt buộc độ dài của chúng phải bằng với độ dài của Series \hspace{0pt}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.cat([}\StringTok{"A "}\NormalTok{, }\StringTok{"B "}\NormalTok{, }\StringTok{"C"}\NormalTok{, np.nan, }\StringTok{"E"}\NormalTok{], na\_rep}\OperatorTok{=}\StringTok{"?"}\NormalTok{) ​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0    aA}
\NormalTok{1    bB}
\NormalTok{2    cC}
\NormalTok{3    d?}
\NormalTok{4    ?E}
\end{Highlighting}
\end{Shaded}

Concat 2 Series

ví dụ ta muốn kết hợp series \texttt{s} với series \texttt{t}, có các cách kết hợp như sau

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{t }\OperatorTok{=}\NormalTok{ pd.Series([}\StringTok{"A "}\NormalTok{, }\StringTok{"B "}\NormalTok{, }\StringTok{"C "}\NormalTok{, }\StringTok{"D"}\NormalTok{], index}\OperatorTok{=}\NormalTok{[}\DecValTok{3}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{])}
\NormalTok{t​}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{3    A}
\NormalTok{0    B}
\NormalTok{4    C}
\NormalTok{2    D}
\NormalTok{dtype: object}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Sử dụng \texttt{join="outer"}, lúc này sẽ kết hợp cả hai index của hai Series với nhau, nếu Series nào không có index của Series kia thì giá trị phần tử tại đó sẽ là NaN
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ s.}\BuiltInTok{str}\NormalTok{.cat(t, join}\OperatorTok{=}\StringTok{"outer"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0    aB}
\NormalTok{1    NaN}
\NormalTok{2     cD}
\NormalTok{3    dA}
\NormalTok{4    NaN}
\end{Highlighting}
\end{Shaded}

Để thay thế NaN bằng một giá trị khác, chúng ta có thể thêm tham số \texttt{na\_rep}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s.}\BuiltInTok{str}\NormalTok{.cat(t, join}\OperatorTok{=}\StringTok{"outer"}\NormalTok{, na\_rep}\OperatorTok{=}\StringTok{"?"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{0    aB}
\NormalTok{1    b?}
\NormalTok{2    cD}
\NormalTok{3    dA}
\NormalTok{4    ?C}
\end{Highlighting}
\end{Shaded}

\section{Xử lý dữ liệu dạng timestamp}\label{xux1eed-luxfd-dux1eef-liux1ec7u-dux1ea1ng-timestamp}

\chapter{Một số kiến thức nâng cao}\label{mux1ed9t-sux1ed1-kiux1ebfn-thux1ee9c-nuxe2ng-cao}

\section{MultiIndex}\label{multiindex}

\chapter{Sample và Resample}\label{sample-vuxe0-resample}

\section{Sample}\label{sample}

\section{Resample}\label{resample}

\section{Window}\label{window}

\subsection{Shift}\label{shift}

\subsection{Rolling}\label{rolling}

\subsection{Expand}\label{expand}

\section{Reshape}\label{reshape}

\subsection{transpose}\label{transpose}

\subsection{pivot}\label{pivot}

\subsection{pivot\_table}\label{pivot_table}

\subsection{melt}\label{melt}

\chapter{Anomaly Detection Project}\label{anomaly-detection-project}

\chapter{Visualize với Matplotlib}\label{visualize-vux1edbi-matplotlib}

\chapter{Cấu hình pandas}\label{cux1ea5u-huxecnh-pandas}

\printindex

\end{document}
